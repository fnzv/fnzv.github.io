{"componentChunkName":"component---src-templates-tags-jsx","path":"/tag/javascript","result":{"data":{"site":{"siteMetadata":{"title":"Ken Powers"}}},"pageContext":{"posts":[{"html":"<p>How do you try out node modules? Have you really thought about it at all? It's\nsomething I've given some thought recently. Today's post presents three options\nfor trying out node modules with pros, cons, and recommended use cases for each.</p>\n<h2>Option 1: Install to a temporary project.</h2>\n<p>This is probably the most common method. It has existed since <a href=\"https://en.wikipedia.org/wiki/Unix_time\" title=\"Unix Time\">the dawn of\ntime</a> and will probably persist until <a href=\"https://en.wikipedia.org/wiki/Year_2038_problem\" title=\"Year 2038 Problem\">the end of time</a> because of\nits simplicity. <a href=\"https://github.com/knpwrs/dotfiles/blob/d37bcbd3abdbc490c7597d68ae88c047c92e16f2/lib/aliases.zsh#L30-L32\" title=\"mkcd\">Create and change to a new directory</a>, <code class=\"language-text\">npm i</code> some\nstuff, and you're off! There are two primary avenues for trying things out with\nthis method: the <code class=\"language-text\">node</code> REPL and temporary scripts on disk executed via the\n<code class=\"language-text\">node</code> CLI. Use the REPL when you're just trying out quick one-liners and use a\nscript when you need to repeat and iterate on something a little more complex.\nWhat more needs to be said?</p>\n<h3>Pros</h3>\n<ul>\n<li>Simple. Nothing extra to install and it just works.</li>\n<li>Use alternate REPLs (Babel, CoffeeScript, etc).</li>\n<li>Flexibility in other ways to execute scripts (e.g., piping to <code class=\"language-text\">stdin</code>, passing\nJavaScript inline to <a href=\"https://nodejs.org/api/cli.html#cli_e_eval_script\" title=\"Evaluate argument as JavaScript.\"><code class=\"language-text\">-e</code></a>, or using <a href=\"https://nodejs.org/api/cli.html#cli_r_require_module\" title=\"Require argument as module.\"><code class=\"language-text\">-r</code></a> one or more times).</li>\n<li>You are in complete control (node version, system tools, environment variables, etc).</li>\n</ul>\n<h3>Cons</h3>\n<ul>\n<li>Ceremony of multiple commands (<code class=\"language-text\">mkdir -p</code>, <code class=\"language-text\">cd</code>, <code class=\"language-text\">npm</code>, possibly other\nthings).</li>\n<li>Sharing anything requires a little extra work (creating a Gist, repo, etc).</li>\n<li>You have to manually require modules if you want to access them by name.</li>\n</ul>\n<h2>Option 2: <del><a href=\"https://tonicdev.com\" title=\"Tonic\">Tonic</a></del> <a href=\"http://blog.runkit.com/2016/09/13/tonic-is-now-runkit-a-part-of-stripe.html\" title=\"RunKit\">RunKit</a></h2>\n<p><strong>Update 2016-09-15:</strong> <a href=\"https://tonicdev.com\" title=\"Tonic\">Tonic</a> is now known as <a href=\"http://blog.runkit.com/2016/09/13/tonic-is-now-runkit-a-part-of-stripe.html\" title=\"RunKit\">RunKit</a>.</p>\n<p>You may have seen the following link in the sidebar on npm:</p>\n<p><a href=\"https://tonicdev.com/npm/lodash\" title=\"Try Lodash on Tonic\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 436px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/453bbfd22fb73dbdb272bc42f5d1221a/8574c/tonic.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.515337423312886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6klEQVQoz61STW+DMAzN//9FXNYdhmi2IiG1aumBG4dyqUhCgIZ8vDrp0HZFqqUnW/aLY7+EdV2HEAKklNBawzmHeZ4xTROixdoWY3meoyxLVFWFoijAOUeWZWiaJhG899saWmshhEgHY7wYA/N4vBrRdGEjGN5srG1bCKVg+x6WJnV6gB0GuHGEjXklU+xI07As8KSvJ2+lSDlP20Sf6rQVu9Y17tTI3G5Q5QFyX0CfjpB8j373AZF/YbzW0JdzQv+5w0T6rlx1+IH85okfB2ImakYIryf904NuS/h95ejjNIF+wf/cylnxBEx7HVJYHa4KAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Tonic\"\n        title=\"Tonic\"\n        src=\"/static/453bbfd22fb73dbdb272bc42f5d1221a/8574c/tonic.png\"\n        srcset=\"/static/453bbfd22fb73dbdb272bc42f5d1221a/222b7/tonic.png 163w,\n/static/453bbfd22fb73dbdb272bc42f5d1221a/ff46a/tonic.png 325w,\n/static/453bbfd22fb73dbdb272bc42f5d1221a/8574c/tonic.png 436w\"\n        sizes=\"(max-width: 436px) 100vw, 436px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></a></p>\n<p>That's a link to <a href=\"https://tonicdev.com\" title=\"Tonic\">Tonic</a>, a service which gives you <em>notebooks</em> to play around\nwith node modules. These notebooks remind me a lot of Mathematica notebooks but\nwith JavaScript instead of crazy math stuff. You can essentially think of them\nas node REPLs in your browser, with access to every version of every module on\nnpm. You also get a host of other cool features, like <a href=\"https://tonicdev.com/tonic/city-forecast\" title=\"Tonic Data Visualization\">data\nvisualization</a>, <a href=\"https://tonicdev.com/docs/endpoint\" title=\"Tonic Endpoint\">simple endpoint hosting</a>, and the\nability to share whatever you create. Additionally, <a href=\"https://tonicdev.uservoice.com/knowledgebase/articles/765846-how-do-i-customize-the-example-for-my-npm-package\" title=\"How do I customize the example for my npm package?\">module authors can declare\nexamples for their modules directly in their <code class=\"language-text\">package.json</code></a>.</p>\n<p><a href=\"https://tonicdev.com/tonic/city-forecast\" title=\"Tonic Data Visualization\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1dc04702facb5318501c2191585ea31c/460fa/tonic-data.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.68711656441718%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACl0lEQVQ4y31UiXKiQBD1/79rayubROMBihzGAxUEuY8ZZuBtz2BM1VZqqXpOT9P9+qDbyTAAYdEiTFKEWYprdkcS+2izELwpIEWHXhL6Hsp2oJ//YSJkg6gscC9LXPMUcZmjTgPwOkfHanREyusMHWfoyUERj/hZnghRgitH3lE2UmdB7yEVSHhCSgghCF/nQ5bfd2UzAT0qusjOkNkJMnYhkyNkFUOyCoK3EB0nxwGCiAW1YCTqtSw79pClbs9k0ITkdNtCBiakP6XTgFT3yB7PcE3BfAgV5P4JmR5HoiIkG0cH7gXHkPtfhGzMLLTQX+bobxv0sYOBgMgCLjMMoYEh2pLO1gH665LultapwOlpg/xkjiVz1oKHtnYW/gz8aqK72aivFs7uAjfnFcVphczfID4Smcr6PEN6WJDNFtFhjcX8Dy7eciRs2xbelhyOBvzNC/bbGfbOCtZ6juXiHe7qN7z1lGyW2JCuuWzQ+R9wzHfsbNKZcxjLNwS71XeGpvGBJUVxF7/gmm9wrTnWxgyrxRu85ajbkc5YTWGbU9zsF9K9wnvYKd+rt3gQUg8PexefHpXoGTjvtzgfXRw+HeyUbqd0Ni5HD/udA8+1cHJX8D8t+Afy29lwnTUi36WPMowz1hPkF2hAu66jQBxF1aAoK1Q09FmWoWka3SJG77pOaLvRttN3TchofjjNERe9JlFgjGlDFUhtgBpcrknGQCrw8M/m6NVTqxFXLU5xgWsYIUoS7KMYt+CM4h5QdgXq/I4yod2uUgjaKuWonh93mdSomEBc0E5nBaFEGCeI6Y8izHNcctrxNEEQBMiLAjlrkDa1zvgn0onIM7R1DU6lMMZ1f1RJ/dOof8qqtGefad1Ur5+QY+l/AXm3dwNXauulAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Tonic Data Visualization\"\n        title=\"Tonic Data Visualization\"\n        src=\"/static/1dc04702facb5318501c2191585ea31c/a6d36/tonic-data.png\"\n        srcset=\"/static/1dc04702facb5318501c2191585ea31c/222b7/tonic-data.png 163w,\n/static/1dc04702facb5318501c2191585ea31c/ff46a/tonic-data.png 325w,\n/static/1dc04702facb5318501c2191585ea31c/a6d36/tonic-data.png 650w,\n/static/1dc04702facb5318501c2191585ea31c/e548f/tonic-data.png 975w,\n/static/1dc04702facb5318501c2191585ea31c/3c492/tonic-data.png 1300w,\n/static/1dc04702facb5318501c2191585ea31c/460fa/tonic-data.png 1910w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></a></p>\n<p>Go ahead and click either screenshot above. They'll take you to some pre-defined\nnotebooks where you can play around. Better yet, I've embedded a notebook below\nwhere you can try out Lodash:</p>\n<div id=\"tonic-lodash\">\n  // Require everything, or you can `require` individual functions\n  // See https://knpw.rs/blog/using-lodash\n  const _ = require('lodash');\n  _.add(3, 5);\n</div>\n<h3>Pros</h3>\n<ul>\n<li>Nothing to install.</li>\n<li>Cool extra features (sharing, <a href=\"https://tonicdev.com/tonic/city-forecast\" title=\"Tonic Data Visualization\">data visualization</a>,\n<a href=\"https://tonicdev.com/docs/endpoint\" title=\"Tonic Endpoint\">endpoints</a>, etc, all built in). You can even <a href=\"https://tonicdev.com/matt/slack-slash-commands/1.0.0\" title=\"Tonic Slack Slash Commands\">prototype Slack\nslash commands</a>.</li>\n<li>Use any version of node and use any version of any node modules from npm.</li>\n</ul>\n<h3>Cons</h3>\n<ul>\n<li>You have to wait on the server to evaluate your code. It isn't terribly slow,\nbut there is a noticeable delay.</li>\n<li>No tab completion.</li>\n</ul>\n<h2>Option 3: <a href=\"https://github.com/raine/replem\" title=\"repl&#x27;em\">repl'em</a></h2>\n<p><a href=\"https://github.com/raine/replem\" title=\"repl&#x27;em\">repl'em</a> is basically a node REPL which lets you pre-install and require\nmodules from its CLI. Want to try out <a href=\"http://momentjs.com/\" title=\"Moment.js: Parse, validate, manipulate, and display dates in JavaScript.\"><code class=\"language-text\">moment</code></a>? It's this easy:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">replem moment</code></pre></div>\n<p>You are dropped in to a REPL with a variable named <a href=\"http://momentjs.com/\" title=\"Moment.js: Parse, validate, manipulate, and display dates in JavaScript.\"><code class=\"language-text\">moment</code></a> available to you.\nNice!</p>\n<p>Want a REPL where <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\" title=\"MDN: Promise\"><code class=\"language-text\">Promise</code></a> is actually <a href=\"http://bluebirdjs.com/docs/getting-started.html\" title=\"A full-featured promises library with unmatched performance.\"><code class=\"language-text\">bluebird</code></a>? You can alias how\nmodules will be exposed:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">replem bluebird:Promise</code></pre></div>\n<p><a href=\"https://github.com/raine/replem\" title=\"repl&#x27;em\">repl'em</a> also lets you use <code class=\"language-text\">_</code> as an alias, which the default node REPL <a href=\"https://nodejs.org/api/repl.html#repl_repl_features\" title=\"Node REPL Features\">does\nnot</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">replem lodash:_</code></pre></div>\n<p>You can also install and use multiple modules all at once:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">replem bluebird:Promise lodash:_ moment</code></pre></div>\n<p>And then you get some other stuff too, like using specific versions of modules,\nexposing modules' properties, and custom REPLs (e.g., Babel, CoffeeScript, etc).\nSee <a href=\"https://github.com/raine/replem\" title=\"repl&#x27;em\">repl'em</a> for more details.</p>\n<h3>Pros</h3>\n<ul>\n<li>Automatic <code class=\"language-text\">camelCase</code> conversion of <code class=\"language-text\">kebab-case</code> package names.</li>\n<li>Tab completion works.</li>\n<li>Simple interface.</li>\n<li>Use alternate REPLs (Babel, CoffeeScript, etc).</li>\n<li>Retains history of past sessions.</li>\n</ul>\n<h3>Cons</h3>\n<ul>\n<li>Global package to install and keep updated.</li>\n<li>Cannot run scripts from disk (yet, as far as I can tell).</li>\n</ul>\n<h2>So what should I use?</h2>\n<p>This is just what works best for me, you should experiment and find out what\nworks best for you. I've started using <a href=\"https://github.com/raine/replem\" title=\"repl&#x27;em\">repl'em</a> for my quick, one-off\nexperiments in favor of installing things to a local directory. If I need\nsomething just a little more robust, however, like a quick script I'll be\niterating on, I'll favor the temporary project directory. If I intend to share\nor embed something, I'll lean towards <a href=\"https://tonicdev.com\" title=\"Tonic\">Tonic</a>.</p>\n<h2>Did I miss anything?</h2>\n<p>Well, yeah, probably. Feel free to post in the comments down below or <a href=\"https://twitter.com/knpwrs\" title=\"@knpwrs\">reach out\nto me on Twitter</a> to let me know your favorite way to try out node\nmodules.</p>\n<script async src=\"https://embed.tonicdev.com\" data-element-id=\"tonic-lodash\"></script>","id":"47216232-3401-5d68-919d-bc945e9e9fd0","timeToRead":5,"frontmatter":{"date":"March 25, 2016","path":"/blog/trying-node-modules","tags":"javascript","title":"Trying Out Node Modules"}},{"html":"<p><a href=\"http://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm\" title=\"kik, left-pad, and npm\">So a thing happened recently.</a> I'm sure you've heard of it by\nnow. 11 lines of code were unpublished from npm and all hell broke loose. This\npost isn't going to be about my opinion, everyone else on the Internet seems to\nbe handling that just fine. This also isn't going to be a summary of what\nhappened. The <a href=\"http://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm\" title=\"kik, left-pad, and npm\">npm blog post</a> does that just fine and gets in to all the details\nI don't feel like writing about (legal stuff... ugh...). This is going to be a\ndiscussion on the context of why this happened and a few ways it can be avoided\nin the future (but I'm not going to talk about preventing unpublishing, others\naround the Internet including the <a href=\"http://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm\" title=\"kik, left-pad, and npm\">npm blog post</a> already cover that avenue).</p>\n<h2>The origin: micro-libraries and keeping things <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" title=\"Don&#x27;t Repeat Yourself\">DRY</a>.</h2>\n<p>Micro libraries are great. They follow the philosophy of doing one thing and\ndoing it well so we can keep our code <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" title=\"Don&#x27;t Repeat Yourself\">DRY</a> without depending on huge monolithic\nlibraries. Changes, such as bug or compatibility fixes are easily pushed out to\neveryone depending on these micro libraries and everyone is happy. Until one of\nthose micro libraries goes missing.</p>\n<p>Some have suggested that these 11 lines of code were so basic that developers\nshould have implemented them themselves. I disagree with this approach. I don't\nwant my application download size to start bloating because various dependencies\nare all implementing their own functionality when they can all get that\nfunctionality from one place. The next common suggestion is that\nhighly-depended-upon code should be moved in to the standard library. The\nproblem with this idea is that when you are writing JavaScript you typically\naren't just targeting one platform. You are targeting different versions of all\nthe major browser vendors, node, and maybe even Rhino or some other platforms\nthat run JavaScript (I was recently targeting Adobe After Effects which runs\nES3! Party like it's 1999!). History has shown that people are slow to upgrade\n(or they simply <em>can't</em> upgrade) which results in developers polyfilling missing\nfunctionality. And what are they polyfilling with? That's right,\nmicro-libraries!</p>\n<h2>So how do we address this?</h2>\n<p>There are certain things that probably shouldn't be their own module, but that\npath is steering too much towards writing an opinion piece. That said, there is\na very popular library which I would recommend. It's in the title of this post.\nIt's <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a>! As far as my quick glance can tell it is still the most\ndepended-upon module on all of npm (unlikely to be unpublished, and yes <a href=\"http://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm\" title=\"kik, left-pad, and npm\">npm is\nworking on that</a>), <a href=\"https://codecov.io/github/lodash\" title=\"Lodash Code Coverage\">has great code coverage</a>, and is packed\nfull of well-designed and thought-out utility functions including one which does\nthe same thing that the unpublished code from npm did (<a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> calls it\n<a href=\"https://lodash.com/docs#padStart\" title=\"_.padStart\"><code class=\"language-text\">padStart</code></a> to match the <a href=\"https://github.com/tc39/proposal-string-pad-start-end\" title=\"String.prototype.padStart / String.prototype.padEnd\">proposal</a>).</p>\n<p><strong>Update:</strong> <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> is not only the most depended-upon package on npm, <a href=\"https://gist.github.com/anvaka/8e8fa57c7ee1350e3491#file-01-most-dependent-upon-md\" title=\"Top 1000 most depended-upon packages\">it's\nthe most depended-upon by a large margin.</a></p>\n<h2>But isn't Lodash monolithic?</h2>\n<p>If you use it from a CDN, sure. But that's not the use case we're talking about\nhere. We're talking about something which was unpublished from npm. When you\ninstall <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> from npm there are a few ways you can grab only the functions\nyou use so you don't bloat your build. Let's take a look.</p>\n<h2>Option 1: Import / Require Sub-Modules</h2>\n<p>When you install <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> from npm, you can directly access individual functions\nas sub-modules from the main <code class=\"language-text\">lodash</code> module. For our friend, <a href=\"https://lodash.com/docs#padStart\" title=\"_.padStart\"><code class=\"language-text\">padStart</code></a>, that\nlooks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ES2015 import</span>\n<span class=\"token keyword\">import</span> padStart <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash/padStart'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// CommonJS</span>\n<span class=\"token keyword\">const</span> padStart <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lodash/padStart'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That's it! No additional setup required. That works for any function in\n<a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a>. Just add a <code class=\"language-text\">/</code> and get the function you need directly. Only the parts\nof <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> you need will be included in your build and nothing else. And as\nlong as other developers depend on the same version of <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> as you do then\nwe get to stay nice and <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" title=\"Don&#x27;t Repeat Yourself\">DRY</a> (more on this later).</p>\n<h2>Option 2: <code class=\"language-text\">babel-plugin-lodash</code></h2>\n<p>Do you use Babel as a part of your build? Oh, who am I kidding? Of course you\ndo! That means you have another option: <a href=\"https://github.com/lodash/babel-plugin-lodash\" title=\"Use Lodash as a monolithic library without worrying about bundling unused parts.\"><code class=\"language-text\">babel-plugin-lodash</code></a>. You simply use\n<code class=\"language-text\">lodash</code> as if it were a giant monolithic library:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash'</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">padStart</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then all <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> <code class=\"language-text\">import</code>s (and <code class=\"language-text\">require</code>s) and usages are rewritten to be as\nif you used the first option:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> _padStart <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash/padStart'</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">_padStart</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You can also use the partial import syntax from ES2015. This:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  map<span class=\"token punctuation\">,</span>\n  reject<span class=\"token punctuation\">,</span>\n  take<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Becomes this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> _map <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash/map'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> _reject <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash/reject'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> _take <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash/take'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">_map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">_take</span><span class=\"token punctuation\">(</span><span class=\"token function\">_reject</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It'll even work if you rename your imports, as such:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  map <span class=\"token keyword\">as</span> ldMap<span class=\"token punctuation\">,</span>\n  reject <span class=\"token keyword\">as</span> ldReject<span class=\"token punctuation\">,</span>\n  take <span class=\"token keyword\">as</span> ldTake<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">ldMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ldTake</span><span class=\"token punctuation\">(</span><span class=\"token function\">ldReject</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Option 3: <a href=\"https://www.npmjs.com/package/lodash-es\" title=\"Lodash Exported as ES Modules\"><code class=\"language-text\">lodash-es</code></a> and <a href=\"http://www.2ality.com/2015/12/webpack-tree-shaking.html\" title=\"Tree-shaking with webpack 2 and Babel 6\">Tree Shaking</a></h2>\n<p>That first option has been around for a while. The second option is newer and\ndoesn't require you to be as explicit, but configuring your build around a\nspecific library may not appeal to everyone. There is an even newer technique\nthat will probably be all the rage any day now: <a href=\"http://www.2ality.com/2015/12/webpack-tree-shaking.html\" title=\"Tree-shaking with webpack 2 and Babel 6\">tree shaking</a> for ES2015. There\nare two module bundlers I can think of off the top of my head that support it\nout of the box: <a href=\"http://webpack.github.io/\" title=\"webpack module bundler\">webpack 2</a> and <a href=\"http://rollupjs.org/\" title=\"Next-generation ES6 module bundler\">Rollup</a>. <a href=\"http://www.2ality.com/2015/12/webpack-tree-shaking.html\" title=\"Tree-shaking with webpack 2 and Babel 6\">Tree shaking</a> is still a\nwork in progress and I haven't yet gotten good results trying to shake the tree\nthat is <a href=\"https://www.npmjs.com/package/lodash-es\" title=\"Lodash Exported as ES Modules\"><code class=\"language-text\">lodash-es</code></a> (compare ~100KB to ~4KB for using <code class=\"language-text\">_.padStart</code> in a\nproject). See <a href=\"https://github.com/webpack/webpack/issues/1750\" title=\"Tree Shaking Results for webpack\">this webpack issue</a> and <a href=\"https://github.com/rollup/rollup/issues/45#issuecomment-151160765\" title=\"Tree Shaking Results for Rollup\">this rollup issue\ncomment</a> for more details.</p>\n<h2>Bonus: this all works with <a href=\"https://github.com/lodash/lodash/wiki/FP-Guide\" title=\"lodash/fp\"><code class=\"language-text\">lodash/fp</code></a>!</h2>\n<p><a href=\"https://github.com/lodash/lodash/wiki/FP-Guide\" title=\"lodash/fp\"><code class=\"language-text\">lodash/fp</code></a> just rewrites the signatures of regular <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> functions but\nstill uses the underlying code of the original functions so you are still\nkeeping things DRY if other developers aren't using <a href=\"https://github.com/lodash/lodash/wiki/FP-Guide\" title=\"lodash/fp\"><code class=\"language-text\">lodash/fp</code></a>. It's\nessentially just a wrapper for <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> functions to make them more functional.</p>\n<h2>The downside: this breaks shortcut fusion.</h2>\n<p>Huh? To quote the <a href=\"https://lodash.com/docs#_\" title=\"Lodash Shortcut Fusion\">Lodash documentation</a>:</p>\n<blockquote>\n<p>Lazy evaluation allows several methods to support shortcut fusion. Shortcut\nfusion is an optimization to merge iteratee calls; this avoids the creation of\nintermediate arrays and can greatly reduce the number of iteratee executions.</p>\n</blockquote>\n<p>Of course, if you're migrating from micro-libraries such as <code class=\"language-text\">left-pad</code> then this\nshouldn't really concern you anyway because you didn't have shortcut fusion to\nbegin with. It's just worth noting that <a href=\"https://github.com/lodash/lodash/issues/1426\" title=\"Cherry-Picking and Shortcut Fusion\">if you pick and choose Lodash functions\nindividually you won't be able to use shortcut fusion</a>.</p>\n<h2>Some advice: use semantic versioning!</h2>\n<p>When you are depending on <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> do not depend on an exact version. The\n<a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> maintainers are very good about following semantic versioning which\nmeans breaking changes will only be introduced in major releases. As of this\nwriting, that means you should depend on version <code class=\"language-text\">^4</code> of <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> (or if you run\n<code class=\"language-text\">npm i -S lodash</code> then whatever it puts in your <code class=\"language-text\">package.json</code> is fine, as long\nas it starts with <code class=\"language-text\">^</code>).</p>\n<h2>Staying up to date.</h2>\n<p>So what happens when <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> releases version 5? Fragmentation, that's what!\nSuddenly we're no longer <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" title=\"Don&#x27;t Repeat Yourself\">DRY</a> as some libraries will depend on <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> <code class=\"language-text\">^4</code>\nand others will depend on <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> <code class=\"language-text\">^5</code>. That's where <a href=\"https://greenkeeper.io/\" title=\"Greenkeeper: Your software, up-to-date, all the time.\">Greenkeeper</a> comes in.\n<a href=\"https://greenkeeper.io/\" title=\"Greenkeeper: Your software, up-to-date, all the time.\">Greenkeeper</a> will watch your dependencies and automatically send you pull\nrequests when a new version of something is published that isn't covered by the\nversion ranges in your <code class=\"language-text\">package.json</code>. If your CI passes then you're good to\nmerge (but feel free to run whatever additional checks you want to). I recommend\nthat all open source JavaScript library authors use <a href=\"https://greenkeeper.io/\" title=\"Greenkeeper: Your software, up-to-date, all the time.\">Greenkeeper</a> as it is\nfree for open source projects and it'll help you stay up to date.</p>\n<h2>Conclusion</h2>\n<p>Nothing I wrote about in this post is necessarily new or revolutionary, but\ngiven what I am dubbing <em><a href=\"http://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm\" title=\"kik, left-pad, and npm\">The Great NPM Fiasco of 2016</a></em> I felt\nit was worth discussing in context. I would personally advise that at a minimum,\nif you are depending on a micro-library such as <code class=\"language-text\">pad-left</code>, or something\nsimilar, you should instead depend on <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> and then use <code class=\"language-text\">lodash/padStart</code>,\nor whatever the equivalent <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> functions are for whatever you need in your\nproject. Whatever you do, don't just copy and paste code or re-implement basic\nfunctionality in every project. <a href=\"https://lodash.com/\" title=\"Lodash: A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\">Lodash</a> functions are well-tested (<a href=\"https://travis-ci.org/lodash/\" title=\"Lodash CI\">1</a>,\n<a href=\"https://saucelabs.com/u/lodash\" title=\"Lodash Cross-Browser Tests\">2</a>, <a href=\"https://codecov.io/github/lodash\" title=\"Lodash Code Coverage\">3</a>) and will help you keep everything very <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" title=\"Don&#x27;t Repeat Yourself\">DRY</a>. Small side\nbenefit: your <code class=\"language-text\">package.json</code> will shrink since you only need to depend on one\nlibrary instead of many.</p>","id":"caef8a32-235d-5399-b5ed-27f814ce6eb1","timeToRead":8,"frontmatter":{"date":"March 24, 2016","path":"/blog/using-lodash","tags":"javascript","title":"Using Lodash as a Collection of Micro-Libraries"}},{"html":"<p>Recently I saw this question come up in my Facebook news feed:</p>\n<blockquote>\n<p>Why should I learn Node.js? Anyone want to give me some good reasons?</p>\n</blockquote>\n<p>Well, my anonymous friend. My short answer would be, you shouldn't. At least,\nyou shouldn't <em>specifically</em> learn Node.js. You should learn JavaScript. I mean\n<em>real</em> JavaScript. Not JavaScript, that little toy language you've used for\nclick handlers and the occasional HTTP request, but JavaScript, the language of\nthe Internet. <em><a href=\"https://medium.com/@mjackson/universal-javascript-4761051b7ae9#.bv8a2ech9\" title=\"Universal JavaScript\">Universal</a></em> (sometimes called <em>isomorphic</em>) JavaScript that runs\non the client <em>and</em> the server without modification.</p>\n<h2>Common Complaints</h2>\n<p>Before I dive into why you should learn JavaScript, I'd like to address two of\nthe most common complaints I hear about JavaScript.</p>\n<h3>First complaint: JavaScript is Dynamic. I want types!</h3>\n<p>Yes, you are technically correct. The best kind of correct. JavaScript is\ndynamic. The debate of dynamic vs static languages has been going on for nearly\nfour centuries<sup>1</sup> now and is much larger than I am looking to address\nhere. I will say that if you want static types you should check out <a href=\"http://flowtype.org/\" title=\"Flow: TypeChecker for JavaScript\">Flow</a> or\n<a href=\"http://www.typescriptlang.org/\" title=\"TypeScript: A typed superset of JavaScript that compiles to plain JavaScript.\">TypeScript</a>. I'll touch on both in a little more detail later on.</p>\n<p>I'll also note that both Angular 2 and Dojo 2 are being written in TypeScript.\nWhile that point may appear to contradict what my goal is here I'd like to say\nthat while those frameworks are being written in TypeScript, they will still\nvery much be a part of the JavaScript ecosystem. They will be completely\ninteroperable with JavaScript and will run in all the same places, in the same\nway, and use all the same tools that regular JavaScript does.</p>\n<h3>Second complaint: JavaScript is completely unusable without jQuery.</h3>\n<p>I actually still hear this one a lot. And... it's wrong. It's just <em>completely</em>\nwrong. jQuery does very little to address problems with JavaScript as a\nlanguage. It does <em>a lot</em> to smooth out the differences in APIs exposed by\nbrowsers -- mostly the DOM (especially in older browsers, and <em>especially</em> the\ndreaded Internet Explorer). Node doesn't have a DOM, at least not until <a href=\"https://github.com/tmpvar/jsdom\" title=\"A JavaScript implementation of the WHATWG DOM and HTML standards, for use with Node.js.\">you\nconstruct one from scratch</a>. That said, you'll rarely (if ever) see\njQuery used outside the browser. I've often referred to jQuery as a DOM\nsteamroller. In Node, given the absence of a DOM, there isn't really much for\njQuery to steamroll. Understanding that the APIs exposed by browsers are\ndifferent from JavaScript as a language will help you gain a better appreciation\nfor JavaScript as a platform for application development.</p>\n<p>There are two trends in browser JavaScript right now that address this\ncomplaint. First, browser APIs are converging. Browser vendors are getting rid\nof their differences on their own -- deprecating old, proprietary APIs and\nworking together to produce new, open, and easy-to-understand APIs with\nconsistent implementations (e.g., <a href=\"https://developers.google.com/web/updates/2015/03/introduction-to-fetch?hl=en\" title=\"Introduction to fetch()\"><code class=\"language-text\">fetch</code></a> in place of <a href=\"https://en.wikipedia.org/wiki/XMLHttpRequest\" title=\"XHR: The Beginnings of AJAX\"><code class=\"language-text\">XMLHttpRequest</code></a> and\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\" title=\"Full-Duplex Communication for the Browser\"><code class=\"language-text\">WebSocket</code></a> in place of various solutions for full-duplex communication\nincluding long-polling, Flash, and crazy things with <code class=\"language-text\">iframe</code>s). Second, there\nhas been a rise in the publication and usage of micro-libraries and client-side\npackaging utilities. Many projects are picking and choosing what abstractions\nthey want to include in their client-side JavaScript rather than relying on\nlarge, do-it-all libraries.</p>\n<p>That said, I want to emphasize that the notion that JavaScript requires jQuery\nin order to be usable is just flat-out wrong. It was wrong when it was first\nintroduced and it's especially wrong today when JavaScript that runs in more\nthan just the browser is rising in popularity.</p>\n<h2>So why should I learn JavaScript?</h2>\n<p>I touched on it a little bit in the introduction. The biggest thing I think\nJavaScript has going for it is its <a href=\"https://medium.com/@mjackson/universal-javascript-4761051b7ae9#.bv8a2ech9\" title=\"Universal JavaScript\">universal</a> nature: being able to write an\napplication once that runs everywhere without modification. And, again, I don't\njust mean different browsers. I mean sharing logic (business logic, validation\nlogic), libraries, and skillsets between clients and servers without having to\nrewrite anything or maintain multiple codebases.</p>\n<p>Let's start off with 2015's darling child. <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> is an example of <a href=\"https://medium.com/@mjackson/universal-javascript-4761051b7ae9#.bv8a2ech9\" title=\"Universal JavaScript\">universal</a>\nJavaScript. It is a UI library that runs on clients and on the server. On the\nclient it will render a fully-functional UI to the browser's DOM. On the server\nyou can render to a string of HTML. You may be used to the concept of\npre-compiling and maybe even pre-rendering client-side templates. <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> takes\nthat a step further and lets you render your entire application in any state you\nneed it to be on the server. Once the client has received the rendered HTML,\nyour <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> application can pick up the rendering on the client by hooking up\nall the event handlers required for user interaction and handling all other\nstate changes as a <a href=\"https://en.wikipedia.org/wiki/Single-page_application\" title=\"Single-Page Application\">SPA</a>. If the client has JavaScript disabled then your\napplication can gracefully degrade to doing round-trip server requests as in\ntraditional, pre-ajax applications. This creates the illusion of the ideal\nscenario of progressive enhancement, when in reality what actually happened was\nyour JavaScript application adapted to fit its environment. I want to reiterate\nthat the same <em>exact</em> code that runs on the client also runs on the server. We\ndidn't rewrite anything to make this happen, and it works everywhere.</p>\n<p><a href=\"https://facebook.github.io/react/\" title=\"React\">React</a>, in many cases (if not most cases), lets you forget that the DOM even\nexists. The biggest headache facing JavaScript developers for nearly two\ncenturies<sup>2</sup> has been defeated! For real though, <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> invented a\nconcept the authors refer to as a <a href=\"https://facebook.github.io/react/docs/glossary.html\" title=\"React (Virtual) DOM Terminology\">virtual dom</a>. Essentially you <em>declare</em>\nthe structure of your application, much like in HTML. When you make changes\n<a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> will diff the component tree, figure out what changed, and then apply\nthose changes to the real UI facing the user. The really cool thing about this\nis that these concepts are portable between environments. You don't have to\nrender these interfaces or apply these changes in a web browser.</p>\n<p>Enter <a href=\"https://facebook.github.io/react-native/\" title=\"React Native: A Framework For Building Native Apps with React\">React Native</a>. You can use your existing React Components and JavaScript\nlogic to create native mobile applications for iOS and Android. No, I don't mean\nhybrid apps that run in a <code class=\"language-text\">webview</code>. I mean controlling <em>really real</em> native\nuser interface components from an embedded JavaScript engine in a native\napplication. These applications are indistinguishable from native applications\nwritten in Objective-C or Java. You might have even used one recently and didn't\neven realize it! <a href=\"https://facebook.github.io/react-native/showcase.html\" title=\"Apps using React Native\">Check out these real applications</a> built with <a href=\"https://facebook.github.io/react-native/\" title=\"React Native: A Framework For Building Native Apps with React\">React\nNative</a>.</p>\n<p>There are some huge advantages here. Imagine fixing a bug once and then\ndeploying that single fix to your server, your web app, iOS, and Android. All at\nthe same time. You can more easily share developers across all of your\napplications. Management of features across platforms becomes a lot easier.\nThat's powerful stuff. For a simple introduction, you should check out my good\nfriend and colleague <a href=\"http://jkaufman.io\" title=\"Jon Kaufman\">Jon Kaufman</a>'s post, <a href=\"http://jkaufman.io/react-web-native-codesharing/\" title=\"Sharing Code Between React Web and Native Apps\">Sharing Code Between React Web\nand Native Apps</a>.</p>\n<p><a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> also lets you do other cool stuff, like <a href=\"https://www.youtube.com/watch?v=xsSnOQynTHs\" title=\"Dan Abramov - Live React: Hot Reloading with Time Travel at react-europe 2015\">Hot Loading User Interface\nComponents and Time Travel</a>. Said another way, you can modify your\ncomponents and they will update in the browser while maintaining state. Without\nrefreshing your browser. Then you can even rewind and playback actions that\nmodified your state so you don't have to reproduce the state you are currently\nin, or any state before it. It's even error-resistant. It even works with <a href=\"https://facebook.github.io/react-native/\" title=\"React Native: A Framework For Building Native Apps with React\">React\nNative</a>! Really! <a href=\"https://www.youtube.com/watch?v=xsSnOQynTHs\" title=\"Dan Abramov - Live React: Hot Reloading with Time Travel at react-europe 2015\">Check out the video</a>. Now take it a step further.\nYou have a web app open in Chrome and Firefox on your computer, as well as on\nAndroid and iOS tablets and phones (to test responsive design), and you have\nnative apps open on multiple Android and iOS devices. Change some code, and\n<em>everything</em> updates, in-place. Talk about a productivity boost! This works\nbecause <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> encourages a functional style of writing user interfaces where\nyour state is kept completely separate from your user interface declarations.\nSince <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> works by diffing and applying patches to live user interfaces,\nit's not hard to imagine how everything comes together to enable hot-loading.\nNew declarative representation of UI comes in, apply the state, do a diff, apply\nthe changes to the real UI, done. Except you don't have to worry about any of\nthat because it's already all done for you.</p>\n<h2>Okay. <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> is cool. Why else should I learn JavaScript?</h2>\n<p><a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> isn't the only cool thing going on in the JavaScript community. Here are\nsome other reasons you might consider as to why you should learn JavaScript.</p>\n<h3>A massive, diverse, and vibrant community.</h3>\n<p><a href=\"https://www.npmjs.com/\" title=\"npm is the package manager for javascript.\">NPM</a>, at the time of this writing, is by far <a href=\"http://www.modulecounts.com/\" title=\"Module Counts\">the largest module ecosystem\ncurrently available</a>. This not only indicates a live, vibrant community, but\nalso a low barrier to entry.</p>\n<h3>Browser vendors might work together on new features, but they compete on performance.</h3>\n<p>Because of competition between browser vendors, JavaScript performance is\nimproving all the time. Node currently runs on Google's V8 JavaScript engine, so\nit gets the same improvements that Chrome does. There was also recently a <a href=\"https://github.com/nodejs/node/pull/4765\" title=\"Enable Node.js to run with Microsoft&#x27;s ChakraCore engine\">pull\nrequest</a> to enable Node.js to use Edge's ChakraCore JavaScript Engine.\nIt'll be interesting to see where that goes in the long term.</p>\n<h3>Scalability.</h3>\n<p>You can scale Node.js to <a href=\"http://blog.caustik.com/2012/04/08/scaling-node-js-to-100k-concurrent-connections/\" title=\"Scaling node.js to 100k concurrent connections!\">100,000</a>, <a href=\"http://blog.caustik.com/2012/04/10/node-js-w250k-concurrent-connections/\" title=\"Node.js w/250k concurrent connections!\">250,000</a>, and <a href=\"http://blog.caustik.com/2012/08/19/node-js-w1m-concurrent-connections/\" title=\"Node.js w/1M concurrent connections!\">1,000,000</a> simultaneous open\nsockets on fairly modest hardware (the server in each of those posts has 16GB of\nram).</p>\n<h3>Getting Rid of <code class=\"language-text\">this</code></h3>\n<p>Thanks to libraries like <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a>, <a href=\"http://redux.js.org/\" title=\"Redux: A predictable state container for JavaScript apps.\">Redux</a>, <a href=\"http://ramdajs.com/\" title=\"A practical functional library for Javascript programmers.\">Rambda</a>, and <a href=\"https://lodash.com/\" title=\"A modern JavaScript utility library delivering modularity, performance, &#x26; extras.\"><code class=\"language-text\">lodash/fp</code></a>,\npurely-functional programming is becoming more popular in JavaScript. Not quite\n<a href=\"https://www.youtube.com/watch?v=RqvCNb7fKsg\" title=\"Why Haskell is Great\">Haskell</a>-level but the concepts of pure functions and immutable state are\nthere. <a href=\"https://github.com/garbles/yolk\" title=\"A library for building asynchronous user interfaces.\">Yolk</a> is a really cool user interface library written on top of <a href=\"https://github.com/Reactive-Extensions/RxJS\" title=\"The Reactive Extensions for JavaScript\">RxJS</a>\nand <a href=\"https://github.com/Matt-Esch/virtual-dom\" title=\"A JavaScript DOM model supporting element creation, diff computation and patch operations for efficient re-rendering.\"><code class=\"language-text\">virtual-dom</code></a> that uses JSX and a purely-functional style of programming.</p>\n<h3>Progressive JavaScript</h3>\n<p><a href=\"http://vuejs.org/\" title=\"Reactive Components for Modern Web Interfaces\">Vue.js</a> also looks interesting. The original author presents it as a\n<em>progressive</em> JavaScript framework. That is, a framework of micro-libraries you\ncan adopt one-by-one, as you need them. It doesn't have a native component, but\nyou still get hot loading and a lot of other stuff that <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> gives you. It's\ndefinitely worth checking out. Be sure to check out <a href=\"https://github.com/vuejs/awesome-vue\" title=\"A curated list of awesome things related to Vue.js\">Awesome Vue</a>.</p>\n<h3>Native Applications Without <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a></h3>\n<p>It shouldn't be a secret by now that I'm a big fan of <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a>. That said, you\ndon't need <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> to write <a href=\"https://medium.com/@mjackson/universal-javascript-4761051b7ae9#.bv8a2ech9\" title=\"Universal JavaScript\">universal</a> JavaScript, not even for native mobile\napps! If you're interested by the concept of <a href=\"https://medium.com/@mjackson/universal-javascript-4761051b7ae9#.bv8a2ech9\" title=\"Universal JavaScript\">universal</a> JavaScript but you want\nto try something different than <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> you should take a look at\n<a href=\"https://www.nativescript.org/\" title=\"Build truly native apps with JavaScript\">NativeScript</a>.</p>\n<h3>Atwood's Law</h3>\n<blockquote>\n<p>Any application that can be written in JavaScript, will eventually be written\nin JavaScript.</p>\n</blockquote>\n<p>See <a href=\"https://atom.io/\" title=\"A hackable text editor for the 21st Century\">Atom</a>, <a href=\"https://code.visualstudio.com/\" title=\"Build and debug modern web and cloud applications.\">Visual Studio Code</a>, <a href=\"https://kitematic.com/\" title=\"Run docker containers through a simple, yet powerful graphical user interface\">Kitematic</a>, <a href=\"https://github.com/maxogden/screencat\" title=\"ScreenCat: An open source screen sharing and remote collaboration application.\">ScreenCat</a>, <a href=\"https://slack.com/\" title=\"A messaging app for teams who are changing the world.\">Slack</a>, and like <a href=\"https://github.com/sindresorhus/awesome-electron\" title=\"Useful resources for creating apps with Electron\">a\nbillion other applications</a> all written in <a href=\"http://electron.atom.io/\" title=\"Electron: Build cross platform desktop apps with web technologies\">Electron</a>.</p>\n<h2>What about those static types?</h2>\n<p>Ah, so you stuck around. Here are the details I promised you.</p>\n<p><a href=\"http://flowtype.org/\" title=\"Flow: TypeChecker for JavaScript\">Flow</a> is a TypeChecker for JavaScript. There is support for flow's syntax\nbuilt-in to <a href=\"http://babeljs.io/\" title=\"Babel: The Compiler for Writing Next-Generation JavaScript\">Babel</a> so if you are using <a href=\"http://babeljs.io/\" title=\"Babel: The Compiler for Writing Next-Generation JavaScript\">Babel</a> for compiling your ES2015+ and\nJSX to ES5 and regular JavaScript it's pretty easy to drop-in. <a href=\"http://flowtype.org/\" title=\"Flow: TypeChecker for JavaScript\">Flow</a> takes\nJavaScript that looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x<span class=\"token punctuation\">.</span>length <span class=\"token operator\">*</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Returns `210`</span></code></pre></div>\n<p>And makes it look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x<span class=\"token punctuation\">.</span>length <span class=\"token operator\">*</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Returns `210`</span></code></pre></div>\n<p><a href=\"http://flowtype.org/\" title=\"Flow: TypeChecker for JavaScript\">Flow</a> can also infer types in certain cases:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x <span class=\"token operator\">*</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello, world!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Error!</span></code></pre></div>\n<p>That code would cause a type error because you can't multiply a String by a\nnumber.</p>\n<p><a href=\"http://www.typescriptlang.org/\" title=\"TypeScript: A typed superset of JavaScript that compiles to plain JavaScript.\">TypeScript</a> on the other hand is a superset of JavaScript that provides static\ntyping <a href=\"https://en.wikipedia.org/wiki/TypeScript#Language_features\" title=\"TypeScript Language Features\">and a whole bunch of other features</a>. The most basic example is\nidentical to the <a href=\"http://flowtype.org/\" title=\"Flow: TypeChecker for JavaScript\">Flow</a> code above; however, in my experince, the tooling for\n<a href=\"http://www.typescriptlang.org/\" title=\"TypeScript: A typed superset of JavaScript that compiles to plain JavaScript.\">TypeScript</a> is a lot stronger than that for <a href=\"http://flowtype.org/\" title=\"Flow: TypeChecker for JavaScript\">Flow</a>. <a href=\"https://code.visualstudio.com/\" title=\"Build and debug modern web and cloud applications.\">Visual Studio Code</a> has\nbuilt-in support for <a href=\"http://www.typescriptlang.org/\" title=\"TypeScript: A typed superset of JavaScript that compiles to plain JavaScript.\">TypeScript</a> as does <a href=\"https://www.jetbrains.com/webstorm/\" title=\"WebStorm\">WebStorm</a> (both also include\ntype-aware autocomplete across files). There are also plugins available for\n<a href=\"https://atom.io/packages/atom-typescript\" title=\"Atom TypeScript Package\">Atom</a>, <a href=\"https://www.microsoft.com/en-us/download/details.aspx?id=48593\" title=\"TypeScript for Visual Studio\">Visual Studio</a>, and <a href=\"https://github.com/Microsoft/TypeScript-Sublime-Plugin\" title=\"TypeScript Sublime Text Plugin\">SublimeText</a>.</p>\n<p>If you want to use TypeScript and React Component hot loading you'll need to do\na little bit of extra configuration. React's hot loading depends on using\n<a href=\"http://webpack.github.io/\" title=\"WebPack Module Builder\">WebPack</a>, <a href=\"http://babeljs.io/\" title=\"Babel: The Compiler for Writing Next-Generation JavaScript\">Babel</a>, and <a href=\"https://github.com/gaearon/babel-plugin-react-transform\"><code class=\"language-text\">babel-plugin-react-transform</code></a>. In order to get it\nworking with <a href=\"http://www.typescriptlang.org/\" title=\"TypeScript: A typed superset of JavaScript that compiles to plain JavaScript.\">TypeScript</a> you'll need to activate <a href=\"http://www.typescriptlang.org/\" title=\"TypeScript: A typed superset of JavaScript that compiles to plain JavaScript.\">TypeScript</a>'s <code class=\"language-text\">preserve</code> mode\nwhich leaves JSX untransformed. From there, you can pipe its output into Babel\nrunning your JSX transform. Your <a href=\"http://webpack.github.io/\" title=\"WebPack Module Builder\">WebPack</a> configuration will look something\nlike this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  resolve<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    extensions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'.ts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.tsx'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.js'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  module<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    loaders<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      test<span class=\"token operator\">:</span> <span class=\"token regex\">/\\.tsx?/</span><span class=\"token punctuation\">,</span>\n      loaders<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'babel'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ts'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>From there you'll want to configure <a href=\"http://babeljs.io/\" title=\"Babel: The Compiler for Writing Next-Generation JavaScript\">Babel</a> with a <code class=\"language-text\">.babelrc</code> file and\n<a href=\"http://www.typescriptlang.org/\" title=\"TypeScript: A typed superset of JavaScript that compiles to plain JavaScript.\">TypeScript</a> with a <code class=\"language-text\">tsconfig.json</code> file, making sure to <code class=\"language-text\">preserve</code> JSX so\n<a href=\"http://babeljs.io/\" title=\"Babel: The Compiler for Writing Next-Generation JavaScript\">Babel</a> can transform it. This post is intended to be more about the <em>why</em> than\nthe <em>how</em> so I'm going to leave it there for now. I might visit this topic again\nin the future.</p>\n<h2>Okay, I'm convinced. But <em>how</em> do I learn JavaScript in 2016?</h2>\n<p>That's a good question; however, it is outside the scope of this blog post. That\nquestion will probably be addressed another time in its own post. In the mean\ntime, you should check out the following resources:</p>\n<ul>\n<li><a href=\"http://jlongster.com/Removing-User-Interface-Complexity,-or-Why-React-is-Awesome\" title=\"Removing User Interface Complexity, or Why React is Awesome\">Removing User Interface Complexity, or Why React is Awesome</a></li>\n<li><a href=\"https://egghead.io/series/getting-started-with-redux\" title=\"Getting Started With Redux\">Dan Abramov's video series on getting started with Redux</a></li>\n<li><a href=\"https://github.com/kittens/lerna\" title=\"Lerna: A tool for managing JavaScript projects with multiple packages.\">Lerna</a> -- for managing <a href=\"http://danluu.com/monorepo/\" title=\"Advantages of monolithic version control\">monorepo</a>s which are useful for organizing your\nserver, client, and mobile apps.</li>\n<li><a href=\"http://jkaufman.io/react-web-native-codesharing/\" title=\"Sharing Code Between React Web and Native Apps\">Sharing Code Between React Web and Native Apps</a></li>\n<li><a href=\"https://soundredux.io/\" title=\"Sound Redux\">Sound Redux Website</a> and <a href=\"https://github.com/andrewngu/sound-redux\" title=\"Sound Redux Source Code\">source code</a> -- an open source SoundCloud client written in <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> and <a href=\"http://redux.js.org/\" title=\"Redux: A predictable state container for JavaScript apps.\">Redux</a>.</li>\n<li><a href=\"https://github.com/sorrycc/awesome-javascript\" title=\"A collection of awesome browser-side JavaScript libraries, resources and shiny things.\">Awesome JavaScript</a></li>\n<li><a href=\"https://github.com/enaqx/awesome-react\" title=\"A Collection of Awesome Things Regarding React Ecosystem\">Awesome React</a></li>\n<li><a href=\"https://github.com/jondot/awesome-react-native\" title=\"A curated list of awesome articles, tutorials and resources dealing with React Native.\">Awesome React Native</a></li>\n<li><a href=\"https://github.com/xgrommx/awesome-redux\" title=\"Awesome List of Redux Examples and Middleware\">Awesome Redux</a></li>\n<li><a href=\"https://github.com/este/este\" title=\"Este.js: A dev stack and starter kit for functional and universal (browser, server, mobile) React apps.\">Este.js</a> -- a dev stack and starter kit for functional and universal (browser, server, mobile) React apps.</li>\n</ul>\n<h2><a href=\"https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4#.j1fdmx7ta\">JavaScript Fatigue</a>?</h2>\n<p>Eric Clemmons recently wrote an article entitled <a href=\"https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4#.j1fdmx7ta\">JavaScript Fatigue</a>. It\ndetails what I know a lot of people go through. There are just so many things\ngoing on in the JavaScript ecosystem. Where do you even start? I get it. So\nhere's a list of, given all of my current knowledge of JavaScript and its\necosystem, and no specific knowledge of what it is you're trying to achieve, all\nthe tools and libraries I would use to start a new project:</p>\n<ul>\n<li>\n<p>Libraries</p>\n<ul>\n<li><a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> and / or <a href=\"https://facebook.github.io/react-native/\" title=\"React Native: A Framework For Building Native Apps with React\">React Native</a> for writing your interface.</li>\n<li><a href=\"http://redux.js.org/\" title=\"Redux: A predictable state container for JavaScript apps.\">Redux</a> for managing your application state.</li>\n<li><a href=\"https://github.com/rackt/react-router\" title=\"A complete routing solution for React.js\">React Router</a> (if you need routing).</li>\n</ul>\n</li>\n<li>\n<p>Testing</p>\n<ul>\n<li><a href=\"https://mochajs.org/\" title=\"Mocha is a feature-rich JavaScript test framework running on Node.js and the browser, making asynchronous testing simple and fun.\">Mocha</a> for your test-running framework. Use the\n<a href=\"http://babeljs.io/docs/setup/#mocha\" title=\"Babel Integration with Mocha\"><code class=\"language-text\">--compilers js:babel-register</code></a> option so you don't have to\npre-compile your code.</li>\n<li><a href=\"https://github.com/airbnb/enzyme\" title=\"Enzyme is a JavaScript Testing utility for React that makes it easier to assert, manipulate, and traverse your React Components&#x27; output.\">Enzyme</a> for testing React components in Node without the need for a\n<a href=\"https://github.com/tmpvar/jsdom\" title=\"A JavaScript implementation of the WHATWG DOM and HTML standards, for use with Node.js.\">full DOM</a>.</li>\n<li><a href=\"http://chaijs.com/\" title=\"Chai Assertion Library\"><code class=\"language-text\">chai</code></a> for assertions and <a href=\"https://github.com/producthunt/chai-enzyme\" title=\"Chai.js assertions and convenience functions for testing React Components with enzyme\"><code class=\"language-text\">chai-enzyme</code></a> for assertions on\n<a href=\"https://github.com/airbnb/enzyme\" title=\"Enzyme is a JavaScript Testing utility for React that makes it easier to assert, manipulate, and traverse your React Components&#x27; output.\">Enzyme</a>-rendered <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a> components.</li>\n<li><a href=\"http://sinonjs.org/\" title=\"Standalone test spies, stubs and mocks for JavaScript.\">Sinon</a> (if you need mocks, spies, and whatnot).</li>\n</ul>\n</li>\n<li>\n<p>Tools</p>\n<ul>\n<li><a href=\"http://babeljs.io/\" title=\"Babel: The Compiler for Writing Next-Generation JavaScript\">Babel</a> for compiling ES2015+ and JSX code. Also enables <a href=\"https://github.com/gaearon/babel-plugin-react-transform\">hot-loading UI\ncomponents through transforms</a>.</li>\n<li><a href=\"http://webpack.github.io/\" title=\"WebPack Module Builder\">WebPack</a> for assembling your client packages. Also enables hot-loading UI\ncomponents and application logic through its <a href=\"http://webpack.github.io/docs/hot-module-replacement-with-webpack.html\">hot-module-replacement\nsystem</a>. Also packs up your CSS (SASS, LESS, Stylus, PostCSS,\nwhatever) and a whole bunch of other stuff.</li>\n<li><a href=\"http://eslint.org/\" title=\"ESLint: A pluggable linting utility for JavaScript.\">ESLint</a> for making sure you avoid code-smells and adhere to a consistent\ncode style. I personally use <a href=\"https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb\" title=\"This package provides Airbnb&#x27;s .eslintrc as an extensible shared config.\">AirBnb's ESLint Config</a> because it is\ncomprehensive and popular enough to be consistent with a lot of other\nprojects. It also includes rules for JSX.</li>\n<li><a href=\"http://editorconfig.org/\" title=\"EditorConfig helps developers define and maintain consistent coding styles between different editors and IDEs\">EditorConfig</a> so everyone's editors can have the same formatting settings.</li>\n<li><a href=\"https://atom.io/\" title=\"A hackable text editor for the 21st Century\">Atom</a> as my text editor of choice.</li>\n<li><a href=\"https://atom.io/packages/linter\"><code class=\"language-text\">linter</code></a> and <a href=\"https://atom.io/packages/linter-eslint\"><code class=\"language-text\">linter-eslint</code></a> for ESLint integration in Atom.</li>\n<li><a href=\"https://atom.io/packages/atom-ternjs\"><code class=\"language-text\">atom-ternjs</code></a> for JavaScript code intelligence in Atom.</li>\n<li><a href=\"https://atom.io/packages/autocomplete-modules\"><code class=\"language-text\">autocomplete-modules</code></a> and <a href=\"https://atom.io/packages/autocomplete-paths\"><code class=\"language-text\">autocomplete-paths</code></a> for extended\nautocomplete capabilities in Atom.</li>\n<li><a href=\"https://atom.io/packages/define-jump\"><code class=\"language-text\">define-jump</code></a> to jump to variable definitions in Atom.</li>\n<li><a href=\"https://atom.io/packages/emmet\"><code class=\"language-text\">emmet</code></a> for quickly writing JSX.</li>\n<li><a href=\"https://atom.io/packages/language-babel\"><code class=\"language-text\">language-babel</code></a> for syntax support for ES2015+ and JSX.</li>\n<li><a href=\"https://atom.io/packages/activate-power-mode\"><code class=\"language-text\">activate-power-mode</code></a> for awesome.</li>\n<li><a href=\"https://github.com/kittens/lerna\" title=\"Lerna: A tool for managing JavaScript projects with multiple packages.\">Lerna</a> for managing a <a href=\"http://danluu.com/monorepo/\" title=\"Advantages of monolithic version control\">monorepo</a> of all of your projects and their\ninterdependencies.</li>\n</ul>\n</li>\n</ul>\n<p>I'm not a huge fan of boilerplates, but you can find some good starting points\nat <a href=\"https://github.com/enaqx/awesome-react\" title=\"A Collection of Awesome Things Regarding React Ecosystem\">Awesome React</a>, <a href=\"https://github.com/xgrommx/awesome-redux\" title=\"Awesome List of Redux Examples and Middleware\">Awesome Redux</a>, and <a href=\"https://github.com/jondot/awesome-react-native\" title=\"A curated list of awesome articles, tutorials and resources dealing with React Native.\">Awesome React Native</a>.</p>\n<h2>Conclusion</h2>\n<p>JavaScript has come a <em>long</em> way since the early web days. If you haven't\nchecked it out recently you really owe it to yourself to do so. 2015 alone was a\n<strong>huge</strong> year for JavaScript. Between <a href=\"https://facebook.github.io/react/\" title=\"React\">React</a>, <a href=\"http://babeljs.io/\" title=\"Babel: The Compiler for Writing Next-Generation JavaScript\">Babel</a>, <a href=\"https://babeljs.io/docs/learn-es2015/\" title=\"Learn ES2015\">ES2015</a>\nstandardization, and proposals for the future, JavaScript is no longer just that\nlittle toy language you've used for click handlers and the occasional HTTP\nrequest.</p>\n<p><small><sup>1, 2</sup> Or something like that.</small></p>","id":"b8295d2a-6620-5bb5-a426-70a32de92ffa","timeToRead":17,"frontmatter":{"date":"January 29, 2016","path":"/blog/learn-javascript-2016","tags":"javascript","title":"Why You Should Learn JavaScript in 2016"}},{"html":"<p>In <a href=\"/blog/testing-in-browsers-and-node/\" title=\"Testing in Browsers and Node with Mocha, Chai, Sinon, and Testem\">my previous post on testing</a> I covered the basics of testing with\n<a href=\"http://visionmedia.github.io/mocha/\" title=\"Mocha\">Mocha</a>, <a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a>, and <a href=\"http://sinonjs.org/\" title=\"Sinon.JS\">Sinon</a> -- including asynchronous\ntesting and stubbing methods with asynchronous callbacks (such as methods\nwhich make a server request). That's all well and good, but sometimes it's\nmore convenient or natural to synchronously manipulate the JavaScript timer or\ncreate fake servers to instantly and synchronously respond to requests.\n<a href=\"http://sinonjs.org/\" title=\"Sinon.JS\">Sinon</a> provides the facilities to work such magic -- read on to learn\nmore.</p>\n<h2>Fake Timers</h2>\n<p>If you are testing code which uses <code class=\"language-text\">setTimeout</code> or <code class=\"language-text\">setInterval</code> it can be\ntricky to get the asynchronous test right and if your timeouts are of any\nsubstantial length your tests can take longer than ideal to complete. Sinon\nlets us replace the global <code class=\"language-text\">setTimeout</code> and <code class=\"language-text\">setInterval</code> functions with fake\nversions that we can control. Observe:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fake timers'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Overwrite the global timer functions (setTimeout, setInterval) with Sinon fakes</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">useFakeTimers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Restore the global timer functions to their native implementations</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should synchronously advance the JavaScript clock'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Create a spy to record all calls</span>\n    <span class=\"token keyword\">var</span> spy <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Call the spy in 1000ms</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Tick the clock forward 999ms</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// The spy should not have been called yet</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Tick the clock forward 1ms</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Now the spy should have been called</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should also work with setInterval'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Faking the JavaScript clock also works with setInterval:</span>\n    <span class=\"token keyword\">var</span> spy <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>calledTwice<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>calledThrice<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When we call <code class=\"language-text\">sinon.useFakeTimers()</code> Sinon replaces the global <code class=\"language-text\">setTimeout</code>\nand <code class=\"language-text\">setInterval</code> functions and returns a clock object we can control. By\ncalling <code class=\"language-text\">clock.tick(n)</code> we are able to advance the clock by <code class=\"language-text\">n</code> milliseconds.\nWhen the milliseconds we have ticked forward are greater than or equal to the\ndelay parameter given to a timeout or interval the respective callbacks are\ncalled synchronously. In our case the callback is a Sinon spy which we are\nable to examine for call details when we need to make assertions.</p>\n<h2>Ensuring Spy Call Order</h2>\n<p>Spies are capable of determining the order they were called relative to each\nother. We can demonstrate this by testing that a number of timeouts were\ntriggered in the proper order:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should be able to verify call order'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Create some spies</span>\n  <span class=\"token keyword\">var</span> spy1 <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> spy2 <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Set some timeouts</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>spy1<span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>spy2<span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Advance the clock</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Expectations</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">calledBefore</span><span class=\"token punctuation\">(</span>spy2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>I am using <code class=\"language-text\">sinon-chai</code> but you can also verify call order using\n<code class=\"language-text\">spy.calledBefore(otherSpy)</code> and <code class=\"language-text\">spy.calledAfter(otherSpy)</code>.</p>\n<h2>Fake Requests</h2>\n<p>On to faking <code class=\"language-text\">XMLHttpRequest</code>! Sinon allows us to override the global\n<code class=\"language-text\">XMLHttpRequest</code> object and synchronously control its behavior. Consider the\nfollowing:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fake requests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Overwrite the global XMLHttpRequest with Sinon fakes</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>xhr <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">useFakeXMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Create an array to store requests</span>\n    <span class=\"token keyword\">var</span> requests <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requests <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Keep references to created requests</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>xhr<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">xhr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      requests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Restore the global timer functions to their native implementations</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>xhr<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake XMLHttpRequests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Create a spy</span>\n    <span class=\"token keyword\">var</span> spy <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Request using jQuery</span>\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Verify that the request is tracked -- not really necessary, just a demonstration</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requests<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Respond to the request</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requests<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">respond</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// The spy was called synchrnously, verify its call details.</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Before each test we set up the fake <code class=\"language-text\">XMLHttpRequest</code> and override <code class=\"language-text\">onCreate</code>\nso that we may track all requests we make using it. After each test we restore\nthe native <code class=\"language-text\">XMLHttpRequest</code> object. In the actual test we make a request with\njQuery, make sure the proper number of requests were sent, and then respond to\nthe request with headers and data which causes jQuery to synchronously call a\nspy we set up.</p>\n<p>Cool stuff, but shouldn't there be an easier way to accomplish all of this\nwithout having to keep track of requests? Read on to learn about fake servers\nin Sinon.</p>\n<h2>Fake Servers</h2>\n<p>Fake servers in Sinon are an extension of fake requests which keep track of\nrequests for us so we don't have to! Fake servers work very similarly to fake\nrequests, as such:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fake servers'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Set up a fake server (calls `sinon.useFakeXMLHttpRequest()`)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span>fakeServer<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Create a spy to record server responses.</span>\n    <span class=\"token keyword\">var</span> spy <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Request with jQuery</span>\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">always</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// MAKE SURE YOU CALL `server.respond()`!</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respond</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Make assertions, onces again, everything is synchronous.</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>calledOnce<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Restore native functionality.</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (basic response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (url, response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (url regex, response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\/foo\\/bar\\/baz$/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (method, url, response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (method, url regex, response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token regex\">/\\/foo\\/bar\\/baz$/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (method, url, [code, headers, response])'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (method, url regex, [code, headers, response])'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token regex\">/\\/foo\\/bar\\/baz$/</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here we have seven tests which all have the same assertions. For that reason,\nI put the assertions in the <code class=\"language-text\">afterEach</code> hook. The basic flow of using fake\nservers is as such:</p>\n<ul>\n<li><strong>Before Each:</strong> Create a fake server, overriding native functionality.</li>\n<li><strong>Test:</strong> Tell the fake server how to respond to requests with\n<code class=\"language-text\">server.respondWith(...)</code>.</li>\n<li><strong>Test:</strong> Make requests using your favorite method.</li>\n<li><strong>Test:</strong> Tell the fake server to synchronously respond with\n<code class=\"language-text\">server.respond()</code>.</li>\n<li><strong>After Each:</strong> Restore native functionality.</li>\n</ul>\n<p>The reason I have seven tests is to demonstrate all the different ways you can\nhave a server respond to requests by using the different signatures of\n<code class=\"language-text\">server.respondWith(...)</code>. In order, each of the tests do the following:</p>\n<ol>\n<li>Respond to all requests with the same plain text.</li>\n<li>Respond to all requests with a specific url.</li>\n<li>Respond to all requests to an url matching a given regular expression.</li>\n<li>Respond to all <code class=\"language-text\">GET</code> requests to a specific url.</li>\n<li>Respond to all <code class=\"language-text\">GET</code> requests to an url matching a given regular\nexpression.</li>\n<li>Respond to all <code class=\"language-text\">GET</code> requests to a specific url with custom headers.</li>\n<li>Respond to all <code class=\"language-text\">GET</code> requests to an url matching a given regular expression\nwith custom headers.</li>\n</ol>\n<p>As you can see, fake servers are extremely flexible and are capable of\ncompletely decoupling your front-end tests from your back end enabling you to\nnot have to run a server for your tests. This, of course, can be accomplished\nwith regular stubbing, but the fake server approach is often simpler and more\nnatural.</p>\n<h2>JSON-P</h2>\n<p>As of this writing, Sinon doesn't support fake JSON-P requests and it probably\nnever will. The official recommendation is to fall back to stubbing whenever\nyou need to make a JSON-P request. For more information, check out <a href=\"http://sinonjs.org/docs/#json-p\" title=\"Sinon JSON-P Workaround\">the\nofficial documentation</a>.</p>\n<h2>Conclusion</h2>\n<p>By using advanced features provided by <a href=\"http://sinonjs.org/\" title=\"Sinon.JS\">Sinon</a> we are able to simplify\nand even drastically improve the performance of tests which rely on\n<code class=\"language-text\">setTimeout</code>, <code class=\"language-text\">setInterval</code>, and making requests for external resources. To\nlearn more, be sure to check out <a href=\"http://sinonjs.org/docs/\" title=\"Sinon.JS Official Documentation\">Sinon's Official Documentation</a>.</p>","id":"0d234bb2-8f19-5619-bf9b-9d90ac529844","timeToRead":6,"frontmatter":{"date":"January 01, 2014","path":"/blog/advanced-features-in-sinon","tags":"javascript, testing","title":"Advanced Features in Sinon"}},{"html":"<p><em>Partially applied functions</em>, or <em>partials</em> for short, are functions with\npre-set arguments. The use of partials is very common in functional\nprogramming and has been implemented in several JavaScript libraries and more\nrecently in ECMAScript 5 through <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\" title=\"Function.prototype.bind\"><code class=\"language-text\">Function.prototype.bind</code></a>. Consider\nthe following examples:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Adds two numbers</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">add</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Let's make some partials!</span>\n<span class=\"token comment\">// Underscore.js</span>\n<span class=\"token keyword\">var</span> addTwo <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">partial</span><span class=\"token punctuation\">(</span>add<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Dojo.js</span>\n<span class=\"token keyword\">var</span> addFour <span class=\"token operator\">=</span> lang<span class=\"token punctuation\">.</span><span class=\"token function\">partial</span><span class=\"token punctuation\">(</span>add<span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// JavaScript 1.8.5</span>\n<span class=\"token keyword\">var</span> addSix <span class=\"token operator\">=</span> <span class=\"token function\">add</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Let's use our partials!</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">addTwo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Logs 3</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">addFour</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Logs 7</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">addSix</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Logs 11</span></code></pre></div>\n<p>In each of the above examples the original function is not modified -- rather,\na new function is created which calls the original function by concatenating\nthe pre-defined arguments with the call-time arguments. JavaScript's\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\" title=\"Function.prototype.bind\"><code class=\"language-text\">bind</code></a> works a little differently from Underscore's\n<a href=\"http://underscorejs.org/#partial\" title=\"Underscore.js - Partial\"><code class=\"language-text\">_.partial</code></a> and Dojo's <a href=\"http://dojotoolkit.org/reference-guide/1.9/dojo/_base/lang.html#partial\" title=\"Dojo lang.partial\"><code class=\"language-text\">lang.partial</code></a> in that its\nfirst argument becomes the value of <code class=\"language-text\">this</code> when the function is called. You\nwill need to use this if you are partially applying instance methods.\nUnderscore and Dojo provide similar functionality through <a href=\"http://underscorejs.org/#bind\" title=\"Underscore.js - Bind\"><code class=\"language-text\">_.bind</code></a>\nand <a href=\"http://dojotoolkit.org/reference-guide/1.9/dojo/_base/lang.html#hitch\" title=\"Dojo lang.hitch\"><code class=\"language-text\">lang.hitch</code></a> respectively. For the sake of simplicity, these\nfunctions will not be covered here.</p>\n<p>How about a more practical example? <a href=\"http://nodejs.org/\" title=\"Node.js\">Node.js</a> follows a convention for\nall asynchronous callbacks -- they are expected to take an error argument\nfollowed by a result argument. <a href=\"https://github.com/caolan/async\" title=\"Async.js\">Async.js</a>, a library which provides\nfunctions for dealing with asynchronous control flow and collection\nmanipulation, builds upon this convention with functions like\n<a href=\"https://github.com/caolan/async#parallel\" title=\"Async.js - parallel\"><code class=\"language-text\">parallel</code></a> and <a href=\"https://github.com/caolan/async#series\" title=\"Async.js - series\"><code class=\"language-text\">series</code></a> which take arrays of functions\nthat in turn take nothing but these conventional callbacks. Consider the\nfollowing examples:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Without partials</span>\nasync<span class=\"token punctuation\">.</span><span class=\"token function\">parallel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token comment\">// `done` accepts err, result</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span> done<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span> done<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> results</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// err is the first thrown / passed error</span>\n  <span class=\"token comment\">// results is an array of results</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// With async's own partial implementation</span>\nasync<span class=\"token punctuation\">.</span><span class=\"token function\">parallel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token function\">async</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>readFile<span class=\"token punctuation\">,</span> <span class=\"token string\">'foo.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">async</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>readFile<span class=\"token punctuation\">,</span> <span class=\"token string\">'bar.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> results</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// same as before</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Async provides its own partial implementation by the name of <a href=\"https://github.com/caolan/async#apply\" title=\"Async.js - apply\"><code class=\"language-text\">apply</code></a>\nwhich is very similar to Underscore's implementation. By partially applying\n<code class=\"language-text\">fs.readFile</code> we are able to shorten the function signature from <code class=\"language-text\">filename,\nencoding, callback</code> to just <code class=\"language-text\">callback</code> enabling us to make an array of\npartials rather than manually declaring functions as in the first example.</p>\n<p>As a side note, you may have noticed that the last argument to\n<code class=\"language-text\">Async.parallel</code> is a Node-style callback. If you felt so inclined, you could\npartially apply <code class=\"language-text\">Async.parallel</code> and <code class=\"language-text\">Async.series</code> and pass those partials to\nother calls to <code class=\"language-text\">Async.parallel</code> and <code class=\"language-text\">Async.series</code>, as such:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">async<span class=\"token punctuation\">.</span><span class=\"token function\">series</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token function\">async</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>async<span class=\"token punctuation\">.</span>parallel<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// First group of parallel tasks</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">async</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>async<span class=\"token punctuation\">.</span>parallel<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// Second group of parallel tasks</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> results</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// err is the same as always</span>\n  <span class=\"token comment\">// results is an array of arrays</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This code will run a group of tasks in parallel and when they are all done run\na second group of tasks in parallel. The final <code class=\"language-text\">results</code> array will be an\narray of arrays where each internal array contains the results of each group\nof tasks. You can easily change up this example to run two groups of serial\ntasks in parallel by changing all calls to <code class=\"language-text\">series</code> with <code class=\"language-text\">parallel</code> and vice\nversa. This will work for most functions provided by Async.</p>\n<p>On to a more practical example, can we read a bunch of files in parallel and\nonly have to write <code class=\"language-text\">async.apply</code> once? Of course! Enter\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\" title=\"Array.prototype.map\"><code class=\"language-text\">Array.prototype.map</code></a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">async<span class=\"token punctuation\">.</span><span class=\"token function\">parallel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'first.txt'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'second.txt'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'foo.txt'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'bar.txt'</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">async</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>readFile<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> results</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Same as before.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this example calling <code class=\"language-text\">map</code> on the array of file names returns an array of\npartially applied <code class=\"language-text\">fs.readfile</code> functions. Using this technique you can\ndynamically create a list of files and read them all into memory. Want to\nlimit the amount of files being read at once? That's what\n<a href=\"https://github.com/caolan/async#parallellimittasks-limit-callback\" title=\"Async.js - parallelLimit\"><code class=\"language-text\">parallelLimit</code></a> is for.</p>\n<h2>Limitations</h2>\n<p>So partials are pretty cool. But you have to be careful about how you use them\n(in JavaScript). In particular things can get tricky when you partially apply\nfunctions which take more arguments than you intend on passing. Consider the\nfollowing:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// This function multiplies all of its arguments together</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">multiply</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">prev<span class=\"token punctuation\">,</span> cur</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> prev <span class=\"token operator\">*</span> cur<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This function multiplies all of its arguments by each other and 2</span>\n<span class=\"token keyword\">var</span> mult2 <span class=\"token operator\">=</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// You might expect this to log [2, 4, 6, 8], but it actually logs [NaN, NaN, NaN, NaN]</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>mult2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// The solution is to explicity call mult2 with the arguments you want to pass</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">mult2</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Really, it's not fair to call this a limitation of partials but JavaScript\nfunctions in general -- we would have gotten a similar result had we not made\na partial. In my experience this problem appears more often when I am using\npartials than when I'm not. What is happening here is that the function passed\nto <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\" title=\"Array.prototype.map\"><code class=\"language-text\">map</code></a> takes three arguments: <code class=\"language-text\">value</code>, <code class=\"language-text\">index</code>, and <code class=\"language-text\">array</code>. Our\nintention is to map each <code class=\"language-text\">value</code> to <code class=\"language-text\">2 * value</code> but instead we end up with\n<code class=\"language-text\">2 * value * index * array</code>. The solution is to explicitly pass the arguments\nyou want into the partial.</p>\n<p>Another point to note is that partials usually have a <code class=\"language-text\">length</code> of <code class=\"language-text\">0</code>. This\nmeans that they are declared without an arguments list. They still take\narguments but anything that checks for a partial's <code class=\"language-text\">length</code> property will more\nthan likely malfunction. For example, asynchronous tests in Mocha:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Some sort of function is declared somewhere as such:</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">asyncFunc</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// do something and call callback per node convention;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// It may be tempting to test it in Mocha as such since the async callback</span>\n<span class=\"token comment\">// will fail the test if an error is passed:</span>\n<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should do something without error'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">asyncFunc</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foobarbaz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// DON'T DO THIS!</span>\n\n<span class=\"token comment\">// However, since the partial doesn't have a `length` property the test will</span>\n<span class=\"token comment\">// complete immediately and the callback will be undefined. The solution is to</span>\n<span class=\"token comment\">// explicity declare async test functions:</span>\n<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should do something without error'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">asyncFunc</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foobarbaz'</span><span class=\"token punctuation\">,</span> done<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>To learn more about testing with Mocha check out <a href=\"/blog/testing-in-browsers-and-node/\" title=\"Testing in Browsers and Node with Mocha, Chai, Sinon, and Testem\">my article on the\nsubject</a> and the <a href=\"http://visionmedia.github.io/mocha/\" title=\"Mocha\">official Mocha documentation</a>.</p>\n<h2>Kinda Partial-Like Things</h2>\n<p>Throughout JavaScript and JavaScript libraries you will find various functions\nwhich take a function as an argument as well as a parameter list to pass to\nthe function. They aren't returning a partial for you to use, but they are an\nopportunity for you to avoid the creation of a partial if you don't have to\nmake one. Take for example <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window.setTimeout\" title=\"MDN - setTimeout\"><code class=\"language-text\">setTimeout</code></a> and\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window.setInterval\" title=\"MDN - setInterval\"><code class=\"language-text\">setInterval</code></a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Consider the following:</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">,</span> bar<span class=\"token punctuation\">,</span> baz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// You may think to compress it with a partial as such:</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token function\">doSomething</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> foo<span class=\"token punctuation\">,</span> bar<span class=\"token punctuation\">,</span> baz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// But this isn't really necessary. The following does the same thing:</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>doSomething<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> foo<span class=\"token punctuation\">,</span> bar<span class=\"token punctuation\">,</span> baz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// It also works with setInterval:</span>\n<span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span>doSomething<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> foo<span class=\"token punctuation\">,</span> bar<span class=\"token punctuation\">,</span> baz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In compliant JavaScript environments, the extra arguments passed to\n<code class=\"language-text\">setTimeout</code> and <code class=\"language-text\">setInterval</code> are passed to the function when it is called.\nBe careful as you can't specify a context this way -- you will have to rely on\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\" title=\"Function.prototype.bind\"><code class=\"language-text\">Function.prototype.bind</code></a>, <a href=\"http://underscorejs.org/#bind\" title=\"Underscore.js - Bind\"><code class=\"language-text\">_.bind</code></a>, and\n<a href=\"http://dojotoolkit.org/reference-guide/1.9/dojo/_base/lang.html#hitch\" title=\"Dojo lang.hitch\"><code class=\"language-text\">lang.hitch</code></a> for that.</p>\n<h2>Conclusion</h2>\n<p>Using partials to adapt existing functions to match a given convention is a\nvery powerful technique. <a href=\"https://github.com/caolan/async\" title=\"Async.js\">Async</a> provides more functions which when\ncombined with <a href=\"http://nodejs.org/\" title=\"Node.js\">Node</a> conventions and partials can lead to very concise,\nreadable, and maintainable code. That being said, you will still have to be\ncareful in situations where arguments don't match up properly or where you\nneed to specify a special context for the partially applied function.</p>","id":"3e8cddb0-bf39-55fc-b9f0-f0eecf02dfb3","timeToRead":7,"frontmatter":{"date":"December 14, 2013","path":"/blog/the-power-and-limitations-of-partials","tags":"javascript, node","title":"The Power and Limitations of Partials"}},{"html":"<p>So you're writing some JavaScript code that has to run in multiple web\nbrowsers as well as Node. How can you effectively test this code? Effective\ntesting means that you should be able to run all tests in all environments on\ndemand, i.e., with the press of a single button the tests should run in Node,\nChrome, Firefox, Internet Explorer, and whatever other environments you have\nset up for testing, and we should avoid code duplication whenever possible.\nContinue reading and I'll walk you through setting up a basic testing\nenvironment using <a href=\"http://visionmedia.github.io/mocha/\" title=\"Mocha\">Mocha</a> as a testing framework, <a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a> for\nassertions, <a href=\"http://sinonjs.org/\" title=\"Sinon\">Sinon</a> for mocking, and <a href=\"https://github.com/airportyh/testem\" title=\"Testem\">Testem</a> as a universal\ntest runner. Basic knowledge of testing, asserting, and mocking in languages\nother than JavaScript is assumed. Those of you who are familiar with testing,\nasserting, and mocking in JavaScript will want to <a href=\"#testem\">skip to the\nTestem</a> section below -- that's where the meat and potatoes of\npulling everything together into a working example is.</p>\n<h2>Mocha</h2>\n<p><a href=\"http://visionmedia.github.io/mocha/\" title=\"Mocha\">Mocha</a> is a testing framework for JavaScript which provides a\nflexible, intuitive, and consistent interface for testing JavaScript code,\nboth synchronous and asynchronous. Additionally, it is designed to run in both\nmajor browsers and Node.</p>\n<p>Without further to do, a basic test suite looks like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Library Tests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// set up the environment</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Should add numbers'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// make assertions</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The above code should be fairly self-explanatory. <code class=\"language-text\">describe</code> is used to\ndescribe a test suite, and <code class=\"language-text\">it</code> is used to define actual tests. I am also\nmaking use of a <code class=\"language-text\">before</code> hook to set up the environment prior to running any\ntests. In addition to the <code class=\"language-text\">before</code> hook, Mocha makes available the <code class=\"language-text\">after</code>\nhook, which executes after all tests have run. The <code class=\"language-text\">before</code> and <code class=\"language-text\">after</code> hooks\nadditionally have <code class=\"language-text\">beforeEach</code> and <code class=\"language-text\">afterEach</code> counterparts, which, as their\nnames imply, rather than running before or after all tests run before and\nafter each individual test.</p>\n<h3>Asynchronous Testing</h3>\n<p>One of the advantages of using Mocha as opposed to certain other testing\nframeworks is that it makes asynchronous testing really easy. Consider the\nfollowing test:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should foobar'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Simulate calling an asynchronous method with `setTimeout`</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Make assertions</span>\n    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The only change to the test is that the <code class=\"language-text\">it</code> function now accepts a <code class=\"language-text\">done</code>\nargument. <code class=\"language-text\">done</code> is a function you should call when the test has completed\n(after all assertions). Additionally, <code class=\"language-text\">done</code> accepts an <code class=\"language-text\">Error</code> object as its\nfirst argument if you have one to give it. The previously mentioned <code class=\"language-text\">before</code>,\n<code class=\"language-text\">beforeEach</code>, <code class=\"language-text\">after</code>, and <code class=\"language-text\">afterEach</code> hooks can also be set up to run\nasynchronously in the same fashion:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'async tests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Before Hooks</span>\n  <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Tests</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should foo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should bar'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// After Hooks</span>\n  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">after</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The above code will take approximately 8 seconds to run and will follow a\nserial execution path as such:</p>\n<ul>\n<li><code class=\"language-text\">before</code></li>\n<li><code class=\"language-text\">beforeEach</code></li>\n<li><code class=\"language-text\">it</code> should foo</li>\n<li><code class=\"language-text\">afterEach</code></li>\n<li><code class=\"language-text\">beforeEach</code></li>\n<li><code class=\"language-text\">it</code> should bar</li>\n<li><code class=\"language-text\">afterEach</code></li>\n<li><code class=\"language-text\">after</code></li>\n</ul>\n<p>Of course, you can mix synchronous and asynchronous hooks and tests and\neverything will run serially with no extra effort.</p>\n<p>You may have noticed that I haven't been making any assertions. That is\nbecause Mocha is designed to let you use your own assertions library. Node\nprovides an <code class=\"language-text\">assert</code> module, but we want to use the same tests and assertions\nin all of our environments, not just Node. This is where <a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a> comes\nin.</p>\n<h2>Chai</h2>\n<p><a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a> is an assertions library which provides multiple styles of\nassertions for your to use as you see fit. I prefer\n<a href=\"http://chaijs.com/api/bdd/\"><code class=\"language-text\">expect</code></a>-style assertions which read like\nsentences. See the following examples:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'three'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>deep<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">instanceOf</span><span class=\"token punctuation\">(</span>Error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, the <code class=\"language-text\">expect</code> style of assertions are very readable and even\nself-documenting. The lack of parentheses after <code class=\"language-text\">true</code> in <code class=\"language-text\">to.be.true</code> is not\na mistake. Chai's <code class=\"language-text\">expect</code> style makes use of <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Working_with_Objects#Defining_getters_and_setters\" title=\"Defining Getters and Setters\">JavaScript getters and\nsetters</a> meaning <code class=\"language-text\">to.be.true</code> is not a function, but a property getter.\nIf you need to support an environment which does not support getters and\nsetters, you will have to use <code class=\"language-text\">to.equal(true)</code> or another assertions library\nwhich is purely functional.</p>\n<p>Obviously, the above sample does not cover everything you can do in Chai.\nThere is a <a href=\"http://chaijs.com/api/bdd/\" title=\"Chai BDD API\">list of all available chains and assertions</a> available\nthrough <a href=\"http://chaijs.com/\" title=\"Chai\">Chai's documentation</a>. The assertions provided by Chai cover\neverything you may want to assert, including (deep) (in)equality, inclusion,\nexistence, ranges, regular expression matching, and (static) method\nrespondence. Additional functionality which extends the core of Chai is\navailable in community-provided <a href=\"http://chaijs.com/plugins\" title=\"Chai Plugins\">plugins</a>.</p>\n<h2>Sinon</h2>\n<p>On to everybody's favorite topic: mocking! <a href=\"http://sinonjs.org/\" title=\"Sinon\">Sinon</a> is a library which\nprovides spies, stubs, and mocks for JavaScript. Let's cover each of those in\norder.</p>\n<h3>Spies</h3>\n<p>A <a href=\"http://sinonjs.org/docs/#spies\" title=\"Sinon Spies API\"><code class=\"language-text\">spy</code></a> is a function which automatically records various metrics\nregarding its execution including arguments passed to it, return value, the\nvalue of <code class=\"language-text\">this</code>, and any exceptions thrown for all of its calls. See the\nfollowing example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> func <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// The following two assertions are identical</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>calledOnce<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>callCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// The following two assertions are identical</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>firstCall<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span>sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>number<span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span><span class=\"token function\">getCall</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span>sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>number<span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// You can even verify that a function was called with specific arguments (not just types)</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>firstCall<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, Sinon spies are extremely flexible. This example only begins\nto scratch the surface of spies in Sinon. <code class=\"language-text\">calledOnce</code> is accompanied by\n<code class=\"language-text\">calledTwice</code> and <code class=\"language-text\">calledThrice</code> which are all aliases for checking the\n<code class=\"language-text\">callCount</code>. In addition to <code class=\"language-text\">firstCall</code>, Sinon spies provide <code class=\"language-text\">secondCall</code> and\n<code class=\"language-text\">thirdCall</code> properties which are all aliases for <code class=\"language-text\">getCall(0)</code>, <code class=\"language-text\">getCall(1)</code>,\nand <code class=\"language-text\">getCall(2)</code>, respectively. Anything beyond the third call must be\naccessed with <code class=\"language-text\">getCall(n)</code> where <code class=\"language-text\">n</code> is the number call you want to access.\nCalls can additionally be inspected, in this case to make sure they were\ncalled with a <code class=\"language-text\">number</code> and a <code class=\"language-text\">string</code>. Sinon provides even more matchers for\nthe following situations:</p>\n<ul>\n<li>All basic JavaScript primitives</li>\n<li>Truthy / falsy values</li>\n<li>Referential equality to a given object</li>\n<li>Making sure an argument is an instance of a particular constructor</li>\n<li>Making sure an argument has a property (or its own property) which\noptionally match additional expectations</li>\n</ul>\n<p>Matchers can even be combined; for example, you can check to make sure an\nargument is either a <code class=\"language-text\">string</code> or a <code class=\"language-text\">number</code>. To learn more about this\nfunctionality check out Sinon's <a href=\"http://sinonjs.org/docs/#sinon-match\" title=\"Sinon Matchers API\">matchers documentation</a>.</p>\n<p>Spies can wrap themselves around existing methods on existing methods.\nConsider the following example utilizing <a href=\"http://jquery.com\" title=\"jQuery\">jQuery</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Spy on the `ajax` method of the `jQuery` object</span>\nsinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span>jQuery<span class=\"token punctuation\">,</span> <span class=\"token string\">'ajax'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Call `jQuery.get(...)` which calls `jQuery.ajax` down the chain</span>\njQuery<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/some/resource'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Assert that `jQuery.ajax` was called with the given url.</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>jQuery<span class=\"token punctuation\">.</span>ajax<span class=\"token punctuation\">.</span>calledOnce<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>jQuery<span class=\"token punctuation\">.</span>ajax<span class=\"token punctuation\">.</span><span class=\"token function\">getCall</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/some/resource'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Unwrap `jQuery.ajax` so other tests will be unaffected and can get up their own spies</span>\njQuery<span class=\"token punctuation\">.</span>ajax<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this example I referenced the passed argument directly and checked a\nproperty on it for equality to what was passed. I also called the <code class=\"language-text\">restore()</code>\nmethod on the spy to return <code class=\"language-text\">jQuery.ajax</code> to its original functionality. This\nis an important step in testing (often run in <code class=\"language-text\">after</code> or <code class=\"language-text\">afterEach</code> hooks) to\nmake sure tests and their spies do not interfere with each other.</p>\n<p>For more information on spy functionality in Sinon, including verifying order\nof calls to multiple spies, check out the <a href=\"http://sinonjs.org/docs/#spies\" title=\"Sinon Spies API\">Sinon spy documentation</a>.</p>\n<h3>Stubs</h3>\n<p>A <a href=\"http://sinonjs.org/docs/#stubs\" title=\"Sinon Stubs API\"><code class=\"language-text\">stub</code></a> is a <a href=\"http://sinonjs.org/docs/#spies\" title=\"Sinon Spies API\"><code class=\"language-text\">spy</code></a> with pre-programmed functionality. You\nshould use a stub when you need to control the behavior of a function you are\nspying on. You can very easily program a stub to throw an exception, return a\ngiven value, return and argument which was passed to it, or even call an\nargument which was passed to it -- with or without arguments, synchronously or\nasynchronously. Stubs can even be programmed to do different things when\ndifferent arguments are passed to them. Consider the following example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> func <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">stub</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfunc<span class=\"token punctuation\">.</span><span class=\"token function\">withArgs</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">returns</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfunc<span class=\"token punctuation\">.</span><span class=\"token function\">throws</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">throw</span><span class=\"token punctuation\">(</span>Error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When <code class=\"language-text\">func</code> is passed <code class=\"language-text\">42</code>, it will return <code class=\"language-text\">1</code>. Otherwise, it will throw an\nexception.</p>\n<p>Just like how you can spy on methods of objects, you can stub methods of\nobjects. Consider the following example of stubbing the <code class=\"language-text\">readFile</code> method on\nNode's filesystem module:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Stub the file system module</span>\nsinon<span class=\"token punctuation\">.</span><span class=\"token function\">stub</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">,</span> <span class=\"token string\">'readFile'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Asynchronously call the third argument with a null error and some text when passed certain arguments</span>\nfs<span class=\"token punctuation\">.</span>readFile\n  <span class=\"token punctuation\">.</span><span class=\"token function\">withArgs</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>matchers<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">callsArgWithAsync</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Foo!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Asynchronously call the third argument with an error when passed certain arguments</span>\nfs<span class=\"token punctuation\">.</span>readFile\n  <span class=\"token punctuation\">.</span><span class=\"token function\">withArgs</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>matchers<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">callsArgWithAsync</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'File not found!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Do your testing</span>\n<span class=\"token comment\">// Afterwards make sure you restore `fs.readFile` to its original functionality.</span>\nfs<span class=\"token punctuation\">.</span>readFile<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now everything that calls <code class=\"language-text\">fs.readFile(&#39;foo.txt&#39;, &#39;utf8&#39;, callback)</code> will have\n<code class=\"language-text\">callback</code> called with <code class=\"language-text\">null</code> for an error and <code class=\"language-text\">&#39;Foo!&#39;</code> for data and\neverything that calls <code class=\"language-text\">fs.readFile(&#39;bar.txt&#39;, &#39;utf8&#39;, callback)</code> will have\n<code class=\"language-text\">callback</code> called with an <code class=\"language-text\">Error</code> object. The <code class=\"language-text\">callback</code>s are called\nasynchronously so all other functionality of your program is preserved, but\nyour tests are no longer dependent on the file system. Stubbing methods which\nrely on external resources such as file systems or network connections is very\ncommon in testing as your tests will run faster and will be more portable\noverall.</p>\n<p>To learn more about Sinon stubs, read the <a href=\"http://sinonjs.org/docs/#stubs\" title=\"Sinon Stubs API\">Sinon stub documentation</a>.</p>\n<h3>Mocks</h3>\n<p><a href=\"http://sinonjs.org/docs/#mocks\" title=\"Sinons Mocks API\">Mocks</a> provide fake methods with pre-programmed functionality and with\npre-programmed expectations. For example, you can program a mock to expect a\ncertain number of calls, at most a certain number of calls, at least a certain\nnumber of calls, to never be called, to be called with certain arguments, and\nmore. After your test is done you can call your mock's <code class=\"language-text\">verify</code> method which\nwill throw an exception if the preset expectations are not met. To learn more\nabout mocks and expectations in Sinon you can read <a href=\"http://sinonjs.org/docs/#mocks\" title=\"Sinons Mocks API\">Sinon's mock\ndocumentation</a>.</p>\n<h3>Chai Assertions</h3>\n<p>Sinon provides its own assertions. Despite this, for the sake of consistency,\nI was using Chai assertions in the examples above. There is a plugin available\nfor Chai which can streamline expectations for Sinon spies, stubs, and mocks.\nUsing the plugin, my first Sinon example from above would look like the\nfollowing:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> func <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span>been<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span>been<span class=\"token punctuation\">.</span>calledOnce<span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span>been<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span>sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>number<span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span>been<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>For more information, check out the <a href=\"http://chaijs.com/plugins/sinon-chai\" title=\"Sinon-Chai Plugin Documentation\">Sinon-Chai plugin\ndocumentation</a>.</p>\n<h3>More Sinon Functionality</h3>\n<p>Sinon provides a plethora of other features specific to JavaScript including\nfake timers, fake <code class=\"language-text\">XMLHttpRequest</code>s, and fake servers. To learn more about\nthese features take a look at <a href=\"http://sinonjs.org/docs\" title=\"Sinon Official Documentation\">Sinon's official\ndocumentation</a>.</p>\n<h2>Testem</h2>\n<p>This is where we tie everything together. <a href=\"https://github.com/airportyh/testem\" title=\"Testem\">Testem</a> is a test runner\nwhich can automatically run tests in multiple web browsers and other\nenvironments such as Node. By default tests will run when you connect a\nbrowser or other environment and can be rerun in all connected environments\nwith the press of a button. By default, tests are also automatically rerun\nwhen a change is detected on the file system. Testem is even capable of giving\nyou native system notifications meaning you can just code away in your\nfavorite editor and immediately see test results upon saving without having to\ndo anything.</p>\n<p>Testem provides default HTML pages for running and auto-rerunning as well as\ncollecting test results. Setting it up to run tests in Node requires a little\nbit of set up; however, it is entirely worth it, trust me. Once everything is\nset up not only are tests run automatically but all results are collected\ncentrally so you can instantly see what happened where. In order to streamline\nthis process I have made a <a href=\"https://github.com/KenPowers/testing-in-browsers-and-node\" title=\"GitHub Project\">project available on github</a>.</p>\n<p>First, you need to install <a href=\"http://nodejs.org\" title=\"Node\">Node</a>. My preferred method is to use\n<a href=\"https://github.com/creationix/nvm\" title=\"Node Version Manager\">nvm</a> but you can set it up however you like.</p>\n<p>Next, clone the project down to your local workspace, change into the project\ndirectory, and install all dependencies using the following commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ git clone https://github.com/KenPowers/testing-in-browsers-and-node.git\n$ cd testing-in-browsers-and-node\n$ npm install</code></pre></div>\n<p>Optionally, you can install Testem and Mocha globally (they are both installed\nlocally as a part of the project, but installing them globally will allow you\nto use them elsewhere):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install -g testem mocha</code></pre></div>\n<p>Be aware that as of the writing of this article, if you are running Windows\nthen you will need to <a href=\"https://github.com/airportyh/testem#known-issues\" title=\"Windows Workaround\">follow one extra step</a>.</p>\n<p>Now we can take a look at how everything works together. First, <code class=\"language-text\">testem.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"framework\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"src_files\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"node_modules/chai/chai.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"lib/*\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"test/setup.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"test/*.test.js\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"launchers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"command\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/.bin/mocha -r test/setup.js -R tap test/*.test.js\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"protocol\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tap\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"launch_in_dev\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"node\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let's walk through this file key-by-key. First we have the <code class=\"language-text\">framework</code> option\nset to <code class=\"language-text\">mocha</code>. This tells Testem to load Mocha into all connected web\nbrowsers. Next we have a <code class=\"language-text\">src_files</code> option. These are the files which are\nmonitored for changes as well as served (in order) to all connected web\nbrowsers. We explicity list <code class=\"language-text\">test/setup.js</code> before <code class=\"language-text\">*.test.js</code> to make sure\nour setup file is served and executed before the tests. Next, we set up\nlaunching tests in Node. This is required because by default Testem just sets\nup a server for browsers to connect to. All we need to do to get Node working\nwith Testem is get it running in a similar setup that the browsers will have.\nThe command <code class=\"language-text\">./node_modules/.bin/mocha -r test/setup.js -R tap test/*.test.js</code>\nruns Mocha (node) telling it to require the file <code class=\"language-text\">test/setup.js</code>, use\n<a href=\"http://en.wikipedia.org/wiki/Test_Anything_Protocol\" title=\"Test Anything Protocol\">tap</a> as the protocol (so Testem can read the results), and run all files\nmatching the pattern <code class=\"language-text\">test/*.test.js</code> as tests. If you have Mocha installed\nglobally then you can simply use <code class=\"language-text\">mocha</code> instead of\n<code class=\"language-text\">./node_modules/.bin/mocha</code>. <em>Finally</em>, <code class=\"language-text\">launch_in_dev</code> tells Testem to run\nour Node launcher.</p>\n<p>Now we just have to take a look at one section of <code class=\"language-text\">package.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/.bin/testem\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With this piece of configuration you can run <code class=\"language-text\">npm test</code> which will run the\nlocal installation of Testem which will read <code class=\"language-text\">testem.json</code> and start running\nthe tests. Alternatively, if you have <code class=\"language-text\">testem</code> installed globally then you can\njust run <code class=\"language-text\">testem</code> directly.</p>\n<p>One last file needs a walk though: <code class=\"language-text\">test/setup.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Export modules to global scope as necessary (only for testing)</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> process <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span> <span class=\"token operator\">&amp;&amp;</span> process<span class=\"token punctuation\">.</span>title <span class=\"token operator\">===</span> <span class=\"token string\">'node'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// We are in node. Require modules.</span>\n  expect <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span>\n  sinon <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sinon'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  num <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'..'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  isBrowser <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// We are in the browser. Set up variables like above using served js files.</span>\n  expect <span class=\"token operator\">=</span> chai<span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// num and sinon already exported globally in the browser.</span>\n  isBrowser <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This file exports the libraries we are using as global variables. I know what\nyou are thinking: \"NO! NOT GLOBAL VARIABLES! GLOBAL VARIABLES ARE EVIL!\" The\ntruth of the matter is that when we are testing in multiple environments there\nare different ways to load these dependencies -- we can either do this for\neach test suite or we can do it once up front. Take your pick. This file\nadditionally sets a boolean value <code class=\"language-text\">isBrowser</code> which you can use in the tests\nif you need to test things differently in browsers than you do in Node. You\ncan even set up tests to only run in certain environments by using code like\nthe following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'multi-environment testing'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isBrowser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should foo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// This test will only run in browsers.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should bar'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// This test will only run in Node.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'shold baz'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// This test will run everywhere.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Take a moment to look through the other files included in the project. There\nis no need to walk through them here because after reading this article their\ncontents should be fairly intuitive. That being said, let's do a quick rundown\nof each file. <code class=\"language-text\">lib/num.js</code> contains a basic math library. It has a <code class=\"language-text\">square</code>\nmethod, which squares a given number, and a <code class=\"language-text\">squareRandomNumber</code> method, which\ndepends on a method that asynchronously retrieves a random number.\n<code class=\"language-text\">test/num.test.js</code> tests each of the previously mentioned methods, making use\nof assertions and stubs as necessary.</p>\n<p>Go ahead and run either <code class=\"language-text\">npm test</code> (or <code class=\"language-text\">testem</code> if you installed globally)\nnow.</p>\n<p>Now that Testem is running you'll see a few things. One thing you'll see is a\ntab with the test results for node. Another thing you'll see is a URL you can\nvisit to connect a web browser for testing. After opening the URL in a few web\nbrowsers Testem should look like the following:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aaf20e22b93549b6cef52f64e0da7a3c/b94e3/testem.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.122699386503065%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6UlEQVQoz93SXWuDMBQG4NxNWyI1utXRQhEK263aqo0mJxo/Urfp6P7/f5nO9qLgtu528BBeDjmB5AQ9HU8b+bat3p+b0wqO5CDvk8qipRnLh7RaRLnu81kwDblF59bt9rVzy24tG5sVOAK8F/1qxALHoAf8O0j3GGkTo6TmLic5t1+4KQCHYNdgKzAzMCIxnDUFYVou8gYnaqk+HNlaVJJDYdEvSUHiS56C5nsxD7NBf70d6D67HZr57ErAb4f+tPufNGte2rvz0vEBNY9p5zBUfml2mFqyep014+gcrsbwyJURih/+Zu8TcyR6OgPVL2UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Testem Screenshot\"\n        title=\"Testem Screenshot\"\n        src=\"/static/aaf20e22b93549b6cef52f64e0da7a3c/a6d36/testem.png\"\n        srcset=\"/static/aaf20e22b93549b6cef52f64e0da7a3c/222b7/testem.png 163w,\n/static/aaf20e22b93549b6cef52f64e0da7a3c/ff46a/testem.png 325w,\n/static/aaf20e22b93549b6cef52f64e0da7a3c/a6d36/testem.png 650w,\n/static/aaf20e22b93549b6cef52f64e0da7a3c/e548f/testem.png 975w,\n/static/aaf20e22b93549b6cef52f64e0da7a3c/b94e3/testem.png 1126w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>By using the left and right arrow keys you can see test results and error\nmessages for all browsers and connected launchers. Pressing <code class=\"language-text\">enter</code> will rerun\ntests in all connected environments, and pressing <code class=\"language-text\">q</code> will quit Testem.</p>\n<p>Try making a change to <code class=\"language-text\">lib/num.js</code> that you think will make one or more of\nthe tests fail. You should see Testem automatically rerun the tests and\nfurther see which tests failed in which environments.</p>\n<h2>Other features in Testem</h2>\n<p>Testem does more than just run tests in multiple environments very easily. You\ncan specify preprocessors that run before tests run (e.g., compiling\nCoffeeScript or running a CSS preprocessor), separate source files (monitored\nfor changes) and served files (not monitored for changes), and more (such as\nthe previously mentioned system notifications). To learn about these features\ntake a look at <a href=\"https://github.com/airportyh/testem\" title=\"Testem\">Testem's documentation</a>.</p>\n<h2>Conclusion</h2>\n<p>This article is meant to get you familiar with the basics of multi-environment\ntesting in JavaScript. More articles about each of the above projects\nfeaturing more advanced features are in the pipeline. In the meantime, you can\nread the official documentation of each project here:</p>\n<ul>\n<li><a href=\"http://visionmedia.github.io/mocha/\" title=\"Mocha\">Mocha</a></li>\n<li><a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a></li>\n<li><a href=\"http://sinonjs.org/\" title=\"Sinon\">Sinon</a></li>\n<li><a href=\"https://github.com/airportyh/testem\" title=\"Testem\">Testem</a></li>\n</ul>","id":"43b21bbf-4816-56a3-8489-e0ddcd14433f","timeToRead":15,"frontmatter":{"date":"December 03, 2013","path":"/blog/testing-in-browsers-and-node","tags":"javascript, testing, node, browser","title":"Testing in Browsers and Node with Mocha, Chai, Sinon, and Testem"}}],"tag":"javascript","pagesSum":2,"page":1}}}