{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/2017-08-19-how-to-detect-ddos","result":{"data":{"site":{"siteMetadata":{"title":"sami.pw","siteUrl":"https://sami.pw"}},"markdownRemark":{"html":"<p><img src=\"https://raw.githubusercontent.com/fnzv/fnzv.github.io/5653b21f4114429a5bddf86aaed7891fb3a1e542/imgs/ddos-warz.gif\">\nRecently i was researching a lot on the various denial of service attacks and how to mitigate them from Layer 1 to 7 and as always the most convinient way to stop any attacks is keeping the bad requests/traffic away from your services starting from the first layers of the ISO/OSI model.<br></p>\n<h4>Realistically the only ways to prevent DDoS attacks are:<br></h4>\n<p>a) Layer 3-4 mitigation with <strong>BGP/Cloud</strong> Scrubbing (Sending all your network traffic using BGP or 'sophisticated' VPNs to third-party POP's to delegate attack mitigation).<br></p>\n<ul>\n<li>Pros: This is the only and smart way to properly mitigating attacks, your services won't be hit by attacks/malicious traffic.</li>\n<li>Cons: Paying an External Provider &#x26; bandwidth costs, All your traffic is re-routed so latency, packetloss and any other network issue that could happen to the External Provider affects you directly....And yes there could be false positives and customers may be locked out of their services.<br><br><br></li>\n</ul>\n<p>b) DNS Obfuscation/<strong>CDN Mitigation</strong>/Proxying only legit requests, a well-known example is CloudFlare  (Kinda like Security through Obfuscation.. and it works only if you have certain services and know your stuff.)<br></p>\n<ul>\n<li>Pros: If you only have HTTP(S) services exposed this is a great option and it's cheap or free.. (you can also setup your own private proxying with Nginx on some VPS/Cloud provider with DDoS protection). <br></li>\n<li>Cons: Doesn't work well if you have other exposed services like Email servers,FTP or any dedicated exposed network assigned to you (Example.. if you are a Carrier you can't just hide your site using DNS since they will hit your announced AS networks...)\n<br><br><br></li>\n</ul>\n<p>c) <strong>Layer 6-7 mitigation</strong> using server/service side counter-measures (enabling Nginx rate limiting, Cache filtering, Apache mod<em>security &#x26; mod</em>evasive bans ..)<br></p>\n<ul>\n<li>Pros: Easily to configure and some low-end attacks can be mitigated (example: Website scans, Automated Bots/Aggressive crawlers..)<br></li>\n<li>Cons: A real attack will saturate your uplink and bring you down all your services<br><br><br></li>\n</ul>\n<p>d) <strong>DIY DDoS protection</strong> using Linux boxes and the good old packet filter.<br></p>\n<ul>\n<li>Pros: It's free, it just works, you need only to create your own \"patterns\" and attack/network blacklists.<br></li>\n<li>Cons: You need to have at least 100G Uplinks and expesive dedicated servers to process all fast incoming/outgoing traffic, you have to manage all the network issues your self and if you saturate your links with the upstream BGP provider they may drop your traffic and/or blackhole you anyways as no one wants unwanted bandwidth costs &#x26; saturated links by malicious traffic or bogus packets.<br><br><br></li>\n</ul>\n<p>Before do you even think of option d) watch this:<br><br>\n<img src=\"https://github.com/fnzv/fnzv.github.io/blob/beedd3afa60078ac41b7b574738a22f690bec90a/ddos-fish.gif?raw=true\">\n<br><br></p>\n<p>Cool, but how i detect attacks?  Well if you have $$ and you only believe enterprise stuff <br><br>\n--> grab that 500+ grand network box and put it in front of your DC... whereas if you are an opensource guy you can go for FastNetMon (By Pavel Odintsov) and setup your own Anti-DDoS detection/mitigation solution.<br>\n<br><br></p>\n<h4>What is FastNetMon?<br><br></h4>\n<p>FastNetMon is <strong>DDoS analyzer</strong> that will let you to detect nearly realtime attacks or suspicious traffic (example: VPS X is compromised and starts doing SYN Flood vs outbound nets --> detected and alerted by FNM), FNM isn't just a <br>\ndetection tool but also helps to mitigate attacks, after the ban rule is triggered a bash script is being executed (there are also a lot of 'extra' stuff to do.. Slack webhooks..Keep a track of Influx metircs..Email Alerts...Send an emergency call/SMS..BGP Announce...Shutoff the VPS)<br>\n<br><br>\nScenario 1:<br>\nVPS provider on Hypervisor X protects customers with FNM and when an attacks is detected on NetFlow/sFlow/IPFIX traffic the bash script automatically adds a blackhole rule on edge network device/hypervisor host to avoid degrading network performance for\nother customers<br>\n<br>\nScenario 2:<br>\nCarrier needs to monitor traffic flows on their network boxes, Set ups FNM and gather all flows to monitor subnets to re-route traffic (GoBGP &#x26; ExaBGP are supported by FNM) when links are saturated<br>\n<br>\n..<br>\n...<br>\n<br>\nAnd so on<br>\n<br></p>\n<p>The FNM setup is quite easy to get up and running, the tricky part is setting up Grafana,Influxdb metrics but that's not a problem if you are interested only in detection/mitigation.<br>\nIf you are into dashboarding you could also set up an ELK (this is the icing on the cake) to gather NetFlow data and create great visualization with Kibana (Total PPS in, Top \"Talkers\" on outgoing/incoming traffic, Traffic Categories, Sort by TCP/UDP..). <br><br></p>\n<p>The only requirements are:<br></p>\n<ul>\n<li>Small Server/Virtual Machine that will recieve all the flow traffic from routers/switches via a <a href=\"https://github.com/pavel-odintsov/fastnetmon/blob/master/docs/CAPTURE_BACKENDS.md\">capture backend</a><br></li>\n<li>For automated BGP integration you need to allow the Server to talk directly to the routers/switches<br>\n<br></li>\n</ul>\n<p>Links and Resources:<br></p>\n<ul>\n<li><a href=\"https://github.com/pavel-odintsov/fastnetmon/tree/master/docs\">Github documentation</a><br></li>\n<li><a href=\"https://fastnetmon.com/\">FastNetMon site</a> (Thank you Pavel for this project) <br></li>\n<li><a href=\"http://pmacct.net/\">Managing Flows</a> (Great tool from Paolo Lucente) if you want to collect properly flows you can use nfacct <br><br></li>\n</ul>\n<p>For any question &#x26; discussion don't esitate contact me <br><br></p>","frontmatter":{"date":"August 19, 2017","path":"/blog/2017-08-19-how-to-detect-ddos","tags":"ddos","title":"How to detect & mitigate (D)DoS Attacks using FastNetMon"}}},"pageContext":{"refPath":"/blog/2017-08-19-how-to-detect-ddos","prev":{"frontmatter":{"title":"Building a Private Blockchain with Ethereum","path":"/blog/2017-07-04-bulding-a-blockchain"}},"next":{"frontmatter":{"title":"Setting up your first Mining rig (Using Ubuntu 16.04 LTS Server)","path":"/blog/2017-10-07-Setting-up-a-cryptocurrency-miner"}}}}}